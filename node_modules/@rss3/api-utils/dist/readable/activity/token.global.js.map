{"version":3,"sources":["../../../src/readable/number/index.ts","../../../src/readable/activity/token.ts"],"names":["formatTokenValue","amount_","decimals","result","money","amount","formatUnits","matched","bigNum","unit","token","type","content","meta","tokenSpace","tokenText","tokenSeparator","join","tokens","sep","acc","t","tokenName","tokenImage","tokenNetwork","tokenTime","tokenAddr","tokenHandle","addr","network","INFINITY_VALUE","tokenValue","tokenPlatform","platform","tokenPost","tokenAsset","name","img"],"mappings":"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","file":"token.global.js","sourcesContent":["export function formatTokenValue(amount_?: string | null, decimals?: number) {\n\tlet result = \"0.00\";\n\tlet money: string;\n\tlet amount = amount_;\n\n\tif (amount) {\n\t\tif (Number.isNaN(Number(amount)) || Number(amount) === 0) {\n\t\t\treturn \"0.00\";\n\t\t}\n\n\t\tif (Number(amount) > 0 && decimals !== undefined) {\n\t\t\tamount = formatUnits(amount, decimals);\n\t\t}\n\n\t\tconst matched = amount.match(/^(0.0+)(.*)/);\n\t\tif (Number(amount) > 0 && Number(amount) < 1) {\n\t\t\tmoney = matched\n\t\t\t\t? // biome-ignore lint/style/noNonNullAssertion: Already checked the matched value is not null\n\t\t\t\t\tmatched[1] + matched[2]!.slice(0, 3)\n\t\t\t\t: `0.${amount.split(\"0.\")[1]?.slice(0, 3) ?? \"0\"}`;\n\t\t} else {\n\t\t\tmoney = Number(Number(amount).toFixed(3)).toString();\n\t\t}\n\n\t\tif (!money.includes(\".\")) {\n\t\t\tmoney = Number(amount).toFixed(2);\n\t\t}\n\n\t\tresult = money.replace(/(\\d)(?=(\\d{3})+\\.\\d+)/g, \"$1,\");\n\t}\n\n\treturn result;\n}\n\nexport function formatUnits(bigNum: string, unit: number) {\n\treturn (\n\t\tbigNum.length > unit\n\t\t\t? `${bigNum.slice(0, bigNum.length - unit)}.${bigNum.slice(-unit)}`\n\t\t\t: `0.${\"0\".repeat(unit - bigNum.length)}${bigNum}`\n\t).replace(/0+$/, \"\");\n}\n\nexport function formatThousands(num: number) {\n\tif (Number.isNaN(num)) return num.toString();\n\n\tconst withDecimal = Number(num > 1 ? num.toFixed(2) : num.toFixed(4))\n\t\t.toString()\n\t\t.split(\".\");\n\n\tif (withDecimal.length > 0) {\n\t\t// biome-ignore lint/style/noNonNullAssertion: Already checked the length of withDecimal is greater than 0\n\t\twithDecimal[0] = withDecimal[0]!.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n\t}\n\n\treturn withDecimal.join(\".\");\n}\n\nexport function formatPrecision(num: number, n = 2) {\n\tconst scale = 10 ** n;\n\treturn Math.round(num * scale) / scale;\n}\n","import type { Action, Activity } from \"@rss3/api-core\";\n\nimport { formatTokenValue } from \"../number/index.js\";\n\nexport type TokenType =\n\t| \"text\" // plain text\n\t| \"html\" // html text\n\t| \"number\" // number value, such as token exchange rate\n\t| \"image\" // image url\n\t| \"symbolImage\" // symbol image url\n\t| \"assetImage\" // asset image url\n\t| \"symbol\" // short name for a token, such as BTC, ETH\n\t| \"address\" // wallet address or txn address, such as https://help.coinbase.com/en/coinbase/getting-started/crypto-education/what-is-a-transaction-hash-hash-id\n\t| \"name\" // name for NFT, etc\n\t| \"platform\" // platform name\n\t| \"network\" // network name\n\t| \"separator\" // separator for actions\n\t| \"time\" // time\n\t| \"unknown\"; // unknown data type to tokenize\n\nexport type Token = {\n\ttype: TokenType;\n\tcontent: string;\n\tmeta?: {\n\t\taddress?: string | null;\n\t\tnetwork?: string | null;\n\t\tid?: string | null;\n\t\tpreview?: string;\n\t};\n};\n\nexport function token(\n\ttype: Token[\"type\"],\n\tcontent = \"\",\n\tmeta?: Token[\"meta\"],\n): Token {\n\treturn { type, content, meta };\n}\n\nexport const tokenSpace = tokenText(\" \");\n\nexport const tokenSeparator = token(\"separator\", \"; \");\n\nexport function join(tokens: Token[], sep = tokenSpace): Token[] {\n\treturn tokens\n\t\t.reduce((acc, t) => {\n\t\t\tacc.push(sep, t);\n\t\t\treturn acc;\n\t\t}, [] as Token[])\n\t\t.slice(1);\n}\n\nexport function tokenText(t: string): Token {\n\treturn token(\"text\", t);\n}\n\nexport function tokenName(t: string): Token {\n\treturn token(\"name\", t);\n}\n\nexport function tokenImage(t: string | null | undefined) {\n\treturn token(\"image\", t || \"\");\n}\n\nexport function tokenNetwork(t: string | null | undefined) {\n\treturn token(\"network\", t || \"\");\n}\n\nexport function tokenTime(t: number) {\n\treturn token(\"time\", new Date(t * 1000).toJSON());\n}\n\nexport function tokenAddr(t: string | null | undefined) {\n\treturn token(\"address\", t || \"\");\n}\n\nexport function tokenHandle(\n\tt: string | null | undefined,\n\taddr: string | null | undefined,\n\tnetwork: string | null | undefined,\n) {\n\tif (!addr) return token(\"address\", t || \"\");\n\treturn token(\"address\", t || \"\", { address: addr, network: network || \"\" });\n}\n\nexport type TokenMetadata = {\n\tsymbol?: string;\n\tdecimals?: number;\n\timage?: string;\n\tvalue?: string | null;\n};\n\n// maximum value of uint256\nconst INFINITY_VALUE =\n\t\"115792089237316195423570985008687907853269984665640564039457584007913129639935\";\n\nexport function tokenValue(t: TokenMetadata | null | undefined) {\n\tif (!t) return [token(\"number\", \"0\")];\n\tif (t.value === INFINITY_VALUE)\n\t\treturn [token(\"number\", \"infinite\"), token(\"symbol\", t.symbol)];\n\treturn [\n\t\ttoken(\"symbolImage\", t.image),\n\t\ttoken(\"number\", formatTokenValue(t.value, t.decimals) || \"0\"),\n\t\ttoken(\"symbol\", t.symbol),\n\t];\n}\n\nexport function tokenPlatform(t: Activity | Action) {\n\tlet platform = \"\";\n\tif (t.platform) {\n\t\tplatform = t.platform;\n\t\treturn [tokenText(\"on\"), token(\"platform\", platform)];\n\t}\n\treturn [];\n}\n\nexport function tokenPost(t: Action) {\n\tif (t.tag !== \"social\") {\n\t\treturn tokenText(\"\");\n\t}\n\n\tif (t.metadata) {\n\t\tif (\n\t\t\t\"title\" in t.metadata &&\n\t\t\tt.metadata.title &&\n\t\t\t!(t.platform === \"Lens\" && t.metadata.title)\n\t\t) {\n\t\t\treturn token(\"html\", t.metadata.title);\n\t\t}\n\n\t\tif (\"body\" in t.metadata && t.metadata.body) {\n\t\t\treturn token(\"html\", t.metadata.body);\n\t\t}\n\n\t\tif (\n\t\t\t\"target\" in t.metadata &&\n\t\t\tt.metadata.target &&\n\t\t\t\"body\" in t.metadata.target &&\n\t\t\t// FIXME: remove ts-ignore after GI fixing the type\n\t\t\t// @ts-ignore target is not null\n\t\t\tt.metadata.target.body\n\t\t) {\n\t\t\t// @ts-ignore target is not null\n\t\t\treturn token(\"html\", t.metadata.target.body);\n\t\t}\n\t}\n\n\treturn token(\"html\", \"\");\n}\n\nexport function tokenAsset(name: string, meta?: Token[\"meta\"]) {\n\tconst img = meta?.preview;\n\tif (img) {\n\t\treturn [token(\"assetImage\", img), token(\"name\", name, meta)];\n\t}\n\treturn [token(\"name\", name, meta)];\n}\n"]}