{"version":3,"sources":["../src/error/base.ts","../src/error/websocket.ts","../src/error/data.ts","../src/error/runtime.ts","../src/index.ts","../src/actions/actionGetPriceFeeds.ts","../src/error/index.ts","../src/environment.ts","../src/utils/priceFeedsValidation.ts","../src/actions/actionGetPriceUpdatesStream.ts","../src/utils/priceUpdateStreamValidation.ts","../src/actions/actionGetLatestPriceUpdates.ts","../src/utils/priceUpdatesValidation.ts","../src/actions/actionGetLatestPublisherCaps.ts","../src/utils/publisherCapsValidation.ts"],"sourcesContent":["// Base error codes\nexport enum PythErrorCode {\n  // WebSocket connection errors\n  WS_CONNECTION_TIMEOUT = \"WS_CONNECTION_TIMEOUT\",\n  WS_CONNECTION_REFUSED = \"WS_CONNECTION_REFUSED\",\n  WS_INVALID_URL = \"WS_INVALID_URL\",\n  WS_HEARTBEAT_FAILED = \"WS_HEARTBEAT_FAILED\",\n  WS_SSL_ERROR = \"WS_SSL_ERROR\",\n  WS_INVALID_STATE_TRANSITION = \"WS_INVALID_STATE_TRANSITION\",\n  WS_MESSAGE_PARSE_ERROR = \"WS_MESSAGE_PARSE_ERROR\",\n  WS_RATE_LIMIT_EXCEEDED = \"WS_RATE_LIMIT_EXCEEDED\",\n  WS_INVALID_MESSAGE_FORMAT = \"WS_INVALID_MESSAGE_FORMAT\",\n\n  // Runtime errors\n  RUNTIME_INITIALIZATION = \"RUNTIME_INITIALIZATION\",\n  RUNTIME_CONFIGURATION = \"RUNTIME_CONFIGURATION\",\n  RUNTIME_VALIDATION = \"RUNTIME_VALIDATION\",\n\n  // State management errors\n  STATE_INVALID_TRANSITION = \"STATE_INVALID_TRANSITION\",\n  STATE_PERSISTENCE = \"STATE_PERSISTENCE\",\n  STATE_UNEXPECTED_DISCONNECT = \"STATE_UNEXPECTED_DISCONNECT\",\n  STATE_RECONNECTION_FAILED = \"STATE_RECONNECTION_FAILED\",\n  STATE_MAX_RECONNECT_EXCEEDED = \"STATE_MAX_RECONNECT_EXCEEDED\",\n\n  // Data handling errors\n  DATA_INVALID_SUBSCRIPTION = \"DATA_INVALID_SUBSCRIPTION\",\n  DATA_SUBSCRIPTION_LIMIT = \"DATA_SUBSCRIPTION_LIMIT\",\n  DATA_VALIDATION_FAILED = \"DATA_VALIDATION_FAILED\",\n  DATA_SEQUENCE_ERROR = \"DATA_SEQUENCE_ERROR\",\n  DATA_TRANSFORM_ERROR = \"DATA_TRANSFORM_ERROR\",\n  DATA_SCHEMA_ERROR = \"DATA_SCHEMA_ERROR\",\n  DATA_STALE_PRICE = \"DATA_STALE_PRICE\",\n  DATA_CHAIN_ERROR = \"DATA_CHAIN_ERROR\",\n  DATA_PARSE_ERROR = \"DATA_PARSE_ERROR\",\n  DATA_PRICE_UNAVAILABLE = \"DATA_PRICE_UNAVAILABLE\",\n  DATA_CONFIDENCE_TOO_LOW = \"DATA_CONFIDENCE_TOO_LOW\",\n  DATA_CONTRACT_ERROR = \"DATA_CONTRACT_ERROR\",\n\n  // Generic errors\n  UNKNOWN = \"UNKNOWN\",\n  INTERNAL = \"INTERNAL\",\n  NETWORK = \"NETWORK\",\n  NETWORK_ERROR = \"NETWORK_ERROR\",\n  TIMEOUT = \"TIMEOUT\",\n  INVALID_PARAMETER = \"INVALID_PARAMETER\",\n  SUBSCRIPTION_LIMIT_EXCEEDED = \"SUBSCRIPTION_LIMIT_EXCEEDED\",\n  WEBSOCKET_ERROR = \"WEBSOCKET_ERROR\",\n  MESSAGE_PROCESSING_ERROR = \"MESSAGE_PROCESSING_ERROR\",\n  CONNECTION_FAILED = \"CONNECTION_FAILED\",\n  HANDLER_FAILED = \"HANDLER_FAILED\",\n\n  // Generic Errors\n  UNKNOWN_ERROR = \"UNKNOWN_ERROR\",\n}\n\nexport enum ErrorSeverity {\n  LOW = \"LOW\", // Non-critical errors that don't affect core functionality\n  MEDIUM = \"MEDIUM\", // Errors that affect some functionality but system can continue\n  HIGH = \"HIGH\", // Critical errors that require immediate attention\n  CRITICAL = \"CRITICAL\", // Alias for FATAL\n  FATAL = \"FATAL\", // System cannot continue operation\n}\n\n// Error detail types\nexport interface ErrorDetails {\n  [key: string]: unknown;\n}\n\n// Extended error interface\nexport interface IPythError {\n  code: PythErrorCode;\n  message: string;\n  severity: ErrorSeverity;\n  timestamp: number;\n  details?: ErrorDetails;\n  originalError?: Error;\n  name: string;\n}\n\n// Base Pyth error class\nexport class PythError extends Error implements IPythError {\n  public readonly timestamp: number;\n  public readonly name: string = \"PythError\";\n\n  constructor(\n    public readonly code: PythErrorCode,\n    public readonly message: string,\n    public readonly severity: ErrorSeverity = ErrorSeverity.MEDIUM,\n    public readonly details?: ErrorDetails,\n    public readonly originalError?: Error\n  ) {\n    super(message);\n    this.timestamp = Date.now();\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n\n  toJSON(): object {\n    return {\n      name: this.name,\n      code: this.code,\n      message: this.message,\n      severity: this.severity,\n      timestamp: this.timestamp,\n      details: this.details,\n      stack: this.stack,\n      originalError: this.originalError\n        ? {\n            name: this.originalError.name,\n            message: this.originalError.message,\n            stack: this.originalError.stack,\n          }\n        : undefined,\n    };\n  }\n}\n\n// Error utility functions\nexport const createPythError = (\n  code: PythErrorCode,\n  message: string,\n  severity?: ErrorSeverity,\n  details?: ErrorDetails,\n  originalError?: Error\n): PythError => {\n  return new PythError(code, message, severity, details, originalError);\n};\n\n// Import types for type guards\nimport type { DataError } from './data';\nimport type { RuntimeError } from './runtime';\nimport type { WebsocketError } from './websocket';\n\n// Type guards\nexport const isDataError = (error: unknown): error is DataError => {\n  return error instanceof Error && error.constructor.name === 'DataError';\n};\n\nexport const isRuntimeError = (error: unknown): error is RuntimeError => {\n  return error instanceof Error && error.constructor.name === 'RuntimeError';\n};\n\nexport const isWebsocketError = (error: unknown): error is WebsocketError => {\n  return error instanceof Error && error.constructor.name === 'WebsocketError';\n};\n\n// Factory function\nexport const createError = (\n  type: 'data' | 'runtime' | 'websocket',\n  options: {\n    code: string;\n    message: string;\n    severity?: ErrorSeverity;\n    details?: ErrorDetails;\n    originalError?: Error;\n  }\n): PythError => {\n  // Import at runtime to avoid circular dependencies\n  const { DataError } = require('./data');\n  const { RuntimeError } = require('./runtime');\n  const { WebsocketError } = require('./websocket');\n  \n  switch (type) {\n    case 'data':\n      return new DataError(options.code, options.message, options.severity, options.details, options.originalError);\n    case 'runtime':\n      return new RuntimeError(options.code, options.message, options.severity, options.details, options.originalError);\n    case 'websocket':\n      return new WebsocketError(options.code, options.message, options.severity, options.details, options.originalError);\n    default:\n      throw new Error(`Invalid error type: ${type}`);\n  }\n};\n","import {\n  PythError,\n  ErrorSeverity,\n  PythErrorCode,\n  type ErrorDetails,\n} from \"./base\";\n\n// WebSocket Error Codes\nexport enum WebsocketErrorCode {\n  CONNECTION_FAILED = \"CONNECTION_FAILED\",\n  CONNECTION_CLOSED = \"CONNECTION_CLOSED\",\n  MESSAGE_PARSE_ERROR = \"MESSAGE_PARSE_ERROR\",\n  SUBSCRIPTION_ERROR = \"SUBSCRIPTION_ERROR\",\n  AUTHENTICATION_ERROR = \"AUTHENTICATION_ERROR\",\n}\n\n// WebSocket States\nexport enum WebSocketState {\n  CONNECTING = \"CONNECTING\",\n  CONNECTED = \"CONNECTED\",\n  RECONNECTING = \"RECONNECTING\",\n  DISCONNECTED = \"DISCONNECTED\",\n  ERROR = \"ERROR\",\n}\n\n// WebSocket specific error class\nexport class WebsocketError extends PythError {\n  public readonly name: string = \"WebsocketError\";\n\n  constructor(\n    code: WebsocketErrorCode | PythErrorCode,\n    message: string,\n    severity: ErrorSeverity = ErrorSeverity.HIGH,\n    details?: ErrorDetails,\n    originalError?: Error\n  ) {\n    super(code, message, severity, details, originalError);\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n\n  // Factory methods\n  static connectionTimeout(details?: ErrorDetails): WebsocketError {\n    return new WebsocketError(\n      PythErrorCode.WS_CONNECTION_TIMEOUT,\n      \"WebSocket connection timed out\",\n      ErrorSeverity.HIGH,\n      details\n    );\n  }\n\n  static connectionRefused(details?: ErrorDetails): WebsocketError {\n    return new WebsocketError(\n      PythErrorCode.WS_CONNECTION_REFUSED,\n      \"WebSocket connection refused\",\n      ErrorSeverity.HIGH,\n      details\n    );\n  }\n\n  static invalidUrl(url: string): WebsocketError {\n    return new WebsocketError(\n      PythErrorCode.WS_INVALID_URL,\n      `Invalid WebSocket URL: ${url}`,\n      ErrorSeverity.HIGH,\n      { url }\n    );\n  }\n\n  static sslError(details?: ErrorDetails): WebsocketError {\n    return new WebsocketError(\n      PythErrorCode.WS_SSL_ERROR,\n      \"SSL/TLS connection error\",\n      ErrorSeverity.HIGH,\n      details\n    );\n  }\n\n  static heartbeatFailure(details?: ErrorDetails): WebsocketError {\n    return new WebsocketError(\n      PythErrorCode.WS_HEARTBEAT_FAILED,\n      \"WebSocket heartbeat check failed\",\n      ErrorSeverity.HIGH,\n      details\n    );\n  }\n\n  static invalidStateTransition(\n    fromState: WebSocketState,\n    toState: WebSocketState,\n    details?: ErrorDetails\n  ): WebsocketError {\n    return new WebsocketError(\n      PythErrorCode.WS_INVALID_STATE_TRANSITION,\n      `Invalid state transition from ${fromState} to ${toState}`,\n      ErrorSeverity.HIGH,\n      { fromState, toState, ...details }\n    );\n  }\n}\n\n","import {\n  PythError,\n  ErrorSeverity,\n  type PythErrorCode,\n  type ErrorDetails,\n} from \"./base\";\n\n// Data Error Codes\nexport enum DataErrorCode {\n  // Validation Errors\n  VALIDATION_FAILED = \"DATA_VALIDATION_FAILED\",\n  INVALID_SUBSCRIPTION = \"DATA_INVALID_SUBSCRIPTION\",\n  SUBSCRIPTION_LIMIT = \"DATA_SUBSCRIPTION_LIMIT\",\n  SCHEMA_ERROR = \"DATA_SCHEMA_ERROR\",\n\n  // Processing Errors\n  SEQUENCE_ERROR = \"DATA_SEQUENCE_ERROR\",\n  TRANSFORM_ERROR = \"DATA_TRANSFORM_ERROR\",\n  PARSE_ERROR = \"DATA_PARSE_ERROR\",\n\n  // Price Feed Errors\n  PRICE_UNAVAILABLE = \"DATA_PRICE_UNAVAILABLE\",\n  CONFIDENCE_TOO_LOW = \"DATA_CONFIDENCE_TOO_LOW\",\n  STALE_PRICE = \"DATA_STALE_PRICE\",\n\n  // Chain-Specific Errors\n  CHAIN_DATA_ERROR = \"DATA_CHAIN_ERROR\",\n  CONTRACT_ERROR = \"DATA_CONTRACT_ERROR\",\n\n  // Network and Connection Errors\n  NETWORK_ERROR = \"NETWORK_ERROR\",\n  WEBSOCKET_ERROR = \"WEBSOCKET_ERROR\",\n  MESSAGE_PROCESSING_ERROR = \"MESSAGE_PROCESSING_ERROR\",\n  CONNECTION_FAILED = \"CONNECTION_FAILED\",\n  HANDLER_FAILED = \"HANDLER_FAILED\",\n  SUBSCRIPTION_LIMIT_EXCEEDED = \"SUBSCRIPTION_LIMIT_EXCEEDED\",\n  PRICE_FEEDS_FETCH_FAILED = \"PRICE_FEEDS_FETCH_FAILED\",\n  \n  // Additional error codes for tests\n  PARSING_ERROR = \"PARSING_ERROR\",\n  DATA_NOT_FOUND = \"DATA_NOT_FOUND\",\n  INSUFFICIENT_DATA = \"INSUFFICIENT_DATA\",\n}\n\n// Validation error type\ntype ValidationError =\n  | string\n  | {\n      field: string;\n      message: string;\n      value?: unknown;\n    };\n\nexport class DataError extends PythError {\n  public readonly name: string = \"DataError\";\n\n  constructor(\n    code: PythErrorCode | DataErrorCode,\n    message: string,\n    severity: ErrorSeverity = ErrorSeverity.MEDIUM,\n    details?: ErrorDetails,\n    originalError?: Error\n  ) {\n    super(code as PythErrorCode, message, severity, details, originalError);\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n\n  // Factory methods\n  static invalidSubscription(subscription: unknown, reason: string): DataError {\n    return new DataError(\n      DataErrorCode.INVALID_SUBSCRIPTION,\n      \"Invalid subscription parameters\",\n      ErrorSeverity.MEDIUM,\n      { subscription, reason }\n    );\n  }\n\n  static subscriptionLimitExceeded(\n    currentCount: number,\n    maxLimit: number\n  ): DataError {\n    return new DataError(\n      DataErrorCode.SUBSCRIPTION_LIMIT,\n      `Subscription limit exceeded (${currentCount}/${maxLimit})`,\n      ErrorSeverity.HIGH,\n      { currentCount, maxLimit }\n    );\n  }\n\n  static validationFailed(\n    data: unknown,\n    validationErrors: ValidationError[]\n  ): DataError {\n    return new DataError(\n      DataErrorCode.VALIDATION_FAILED,\n      \"Data validation failed\",\n      ErrorSeverity.MEDIUM,\n      { data, validationErrors }\n    );\n  }\n\n  static sequenceError(\n    expected: number,\n    received: number,\n    details?: ErrorDetails\n  ): DataError {\n    return new DataError(\n      DataErrorCode.SEQUENCE_ERROR,\n      `Message sequence error: expected ${expected}, received ${received}`,\n      ErrorSeverity.MEDIUM,\n      { expected, received, ...details }\n    );\n  }\n\n  static transformError(\n    data: unknown,\n    targetFormat: string,\n    error?: Error\n  ): DataError {\n    return new DataError(\n      DataErrorCode.TRANSFORM_ERROR,\n      \"Failed to transform data\",\n      ErrorSeverity.MEDIUM,\n      { data, targetFormat },\n      error\n    );\n  }\n\n  static schemaError(\n    data: unknown,\n    schema: Record<string, unknown>,\n    error?: Error\n  ): DataError {\n    return new DataError(\n      DataErrorCode.SCHEMA_ERROR,\n      \"Data does not match schema\",\n      ErrorSeverity.HIGH,\n      { data, schema },\n      error\n    );\n  }\n\n  static stalePriceError(\n    symbol: string,\n    lastUpdateTime: number,\n    maxAge: number\n  ): DataError {\n    return new DataError(\n      DataErrorCode.STALE_PRICE,\n      `Price data for ${symbol} is stale`,\n      ErrorSeverity.HIGH,\n      {\n        symbol,\n        lastUpdateTime,\n        maxAge,\n        currentTime: Date.now(),\n      }\n    );\n  }\n\n  static chainError(\n    chain: string,\n    operation: string,\n    error?: Error\n  ): DataError {\n    return new DataError(\n      DataErrorCode.CHAIN_DATA_ERROR,\n      `Chain-specific error on ${chain} during ${operation}`,\n      ErrorSeverity.HIGH,\n      { chain, operation },\n      error\n    );\n  }\n}\n\n","import {\n  PythError,\n  ErrorSeverity,\n  PythErrorCode,\n  type ErrorDetails,\n} from \"./base\";\n\n// Runtime Error Codes\nexport enum RuntimeErrorCode {\n  CONFIGURATION_ERROR = \"CONFIGURATION_ERROR\",\n  INITIALIZATION_ERROR = \"INITIALIZATION_ERROR\",\n  SERVICE_UNAVAILABLE = \"SERVICE_UNAVAILABLE\",\n  TIMEOUT_ERROR = \"TIMEOUT_ERROR\",\n  PERMISSION_DENIED = \"PERMISSION_DENIED\",\n}\n\nexport class RuntimeError extends PythError {\n  public readonly name: string = \"RuntimeError\";\n\n  constructor(\n    code: RuntimeErrorCode | PythErrorCode,\n    message: string,\n    severity: ErrorSeverity = ErrorSeverity.HIGH,\n    details?: ErrorDetails,\n    originalError?: Error\n  ) {\n    super(code, message, severity, details, originalError);\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n\n  // Factory methods\n  static initializationError(\n    component: string,\n    reason: string,\n    error?: Error\n  ): RuntimeError {\n    return new RuntimeError(\n      PythErrorCode.RUNTIME_INITIALIZATION,\n      `Failed to initialize ${component}: ${reason}`,\n      ErrorSeverity.HIGH,\n      { component, reason },\n      error\n    );\n  }\n\n  static configurationError(\n    component: string,\n    reason: string,\n    error?: Error\n  ): RuntimeError {\n    return new RuntimeError(\n      PythErrorCode.RUNTIME_CONFIGURATION,\n      `Configuration error in ${component}: ${reason}`,\n      ErrorSeverity.HIGH,\n      { component, reason },\n      error\n    );\n  }\n\n  static validationError(\n    component: string,\n    reason: string,\n    error?: Error\n  ): RuntimeError {\n    return new RuntimeError(\n      PythErrorCode.RUNTIME_VALIDATION,\n      `Validation error in ${component}: ${reason}`,\n      ErrorSeverity.HIGH,\n      { component, reason },\n      error\n    );\n  }\n\n  static stateTransitionError(\n    component: string,\n    fromState: string,\n    toState: string,\n    reason: string\n  ): RuntimeError {\n    return new RuntimeError(\n      PythErrorCode.STATE_INVALID_TRANSITION,\n      `Invalid state transition in ${component} from ${fromState} to ${toState}: ${reason}`,\n      ErrorSeverity.HIGH,\n      { component, fromState, toState, reason }\n    );\n  }\n\n  static statePersistenceError(\n    component: string,\n    operation: string,\n    error?: Error\n  ): RuntimeError {\n    return new RuntimeError(\n      PythErrorCode.STATE_PERSISTENCE,\n      `Failed to ${operation} state for ${component}`,\n      ErrorSeverity.HIGH,\n      { component, operation },\n      error\n    );\n  }\n}\n","import type { Plugin } from \"@elizaos/core\";\nimport chalk from \"chalk\";\nimport Table from \"cli-table3\";\nimport ora from \"ora\";\nimport getPriceFeedsAction from \"./actions/actionGetPriceFeeds\";\nimport getPriceUpdatesStreamAction from \"./actions/actionGetPriceUpdatesStream\";\nimport getLatestPriceUpdatesAction from \"./actions/actionGetLatestPriceUpdates\";\nimport getLatestPublisherCapsAction from \"./actions/actionGetLatestPublisherCaps\";\n\n// Start the loader\nconst spinner = ora({\n  text: chalk.cyan(\"Initializing Pyth Data Plugin...\"),\n  spinner: \"dots12\",\n  color: \"cyan\",\n}).start();\n\n// Simulate some loading time\nawait new Promise((resolve) => setTimeout(resolve, 1000));\n\nconst actions = [\n  getPriceFeedsAction,\n  getPriceUpdatesStreamAction,\n  getLatestPriceUpdatesAction,\n  getLatestPublisherCapsAction,\n];\n\n// Initial banner with chalk styling\nconsole.log(\"\\n\" + chalk.cyan(\"┌────────────────────────────────────────┐\"));\nconsole.log(\n  chalk.cyan(\"│\") +\n    chalk.yellow.bold(\"          PYTH DATA PLUGIN             \") +\n    chalk.cyan(\" │\")\n);\nconsole.log(chalk.cyan(\"├────────────────────────────────────────┤\"));\nconsole.log(\n  chalk.cyan(\"│\") +\n    chalk.white(\"  Initializing Pyth Data Services...    \") +\n    chalk.cyan(\"│\")\n);\nconsole.log(\n  chalk.cyan(\"│\") +\n    chalk.white(\"  Version: 1.0.0                        \") +\n    chalk.cyan(\"│\")\n);\nconsole.log(chalk.cyan(\"└────────────────────────────────────────┘\"));\n\n// Stop the loader\nspinner.succeed(chalk.green(\"Pyth Data Plugin initialized successfully!\"));\n\n// Create a beautiful table for actions\nconst actionTable = new Table({\n  head: [\n    chalk.cyan(\"Action\"),\n    chalk.cyan(\"H\"),\n    chalk.cyan(\"V\"),\n    chalk.cyan(\"E\"),\n    chalk.cyan(\"Similes\"),\n  ],\n  style: {\n    head: [],\n    border: [\"cyan\"],\n  },\n});\n\n// Format and add action information\nactions.forEach((action) => {\n  actionTable.push([\n    chalk.white(action.name),\n    typeof action.handler === \"function\" ? chalk.green(\"✓\") : chalk.red(\"✗\"),\n    typeof action.validate === \"function\" ? chalk.green(\"✓\") : chalk.red(\"✗\"),\n    action.examples && action.examples.length > 0\n      ? chalk.green(\"✓\")\n      : chalk.red(\"✗\"),\n    chalk.gray(action.similes?.join(\", \") || \"none\"),\n  ]);\n});\n\n// Display the action table\nconsole.log(\"\\n\" + actionTable.toString());\n\n// Plugin status with a nice table\nconst statusTable = new Table({\n  style: {\n    border: [\"cyan\"],\n  },\n});\n\nstatusTable.push(\n  [chalk.cyan(\"Plugin Status\")],\n  [chalk.white(\"Name    : \") + chalk.yellow(\"pyth-data\")],\n  [chalk.white(\"Actions : \") + chalk.green(actions.length.toString())],\n  [chalk.white(\"Status  : \") + chalk.green(\"Loaded & Ready\")]\n);\n\nconsole.log(\"\\n\" + statusTable.toString() + \"\\n\");\n\nconst pythDataPlugin: Plugin = {\n  name: \"pyth-data\",\n  description: \"Pyth Data Plugin for price feeds and market data\",\n  actions: actions,\n  evaluators: [],\n};\n\n// Export for both CommonJS and ESM\nexport { pythDataPlugin };\nexport default pythDataPlugin;\n","import { type Action, elizaLogger } from \"@elizaos/core\";\nimport type {\n  IAgentRuntime,\n  Memory,\n  State,\n  HandlerCallback,\n  Content,\n  ActionExample,\n} from \"@elizaos/core\";\n// import { HermesClient } from \"../hermes/HermesClient\";\nimport { HermesClient } from \"@pythnetwork/hermes-client\";\nimport { DataError, ErrorSeverity, DataErrorCode } from \"../error\";\nimport {\n  validatePythConfig,\n  getNetworkConfig,\n  getConfig,\n} from \"../environment\";\nimport { validatePriceFeedsData } from \"../utils/priceFeedsValidation\";\n\n// Get configuration for granular logging\nconst config = getConfig();\nconst GRANULAR_LOG = config.PYTH_GRANULAR_LOG;\n\n// Enhanced logging helper\nconst logGranular = (message: string, data?: unknown) => {\n  if (GRANULAR_LOG) {\n    elizaLogger.info(`[PriceFeeds] ${message}`, data);\n    console.log(\n      `[PriceFeeds] ${message}`,\n      data ? JSON.stringify(data, null, 2) : \"\"\n    );\n  }\n};\n\ninterface PriceFeedAttributes {\n  asset_type: string;\n  base: string;\n  description: string;\n  display_symbol: string;\n  quote_currency: string;\n  schedule: string;\n  symbol: string;\n  generic_symbol?: string;\n  cms_symbol?: string;\n  country?: string;\n  cqs_symbol?: string;\n  nasdaq_symbol?: string;\n  contract_id?: string;\n}\n\ninterface GetPriceFeedsContent extends Content {\n  text: string;\n  query?: string;\n  filter?: string;\n  success?: boolean;\n  data?: {\n    feeds: Array<{\n      id: string;\n      attributes: PriceFeedAttributes;\n    }>;\n    count: number;\n    responseType: string;\n    isArray: boolean;\n    error?: string;\n  };\n}\n\nexport const getPriceFeedsAction: Action = {\n  name: \"GET_PRICE_FEEDS\",\n  similes: [\"FETCH_PRICE_FEEDS\", \"LIST_PRICE_FEEDS\", \"QUERY_PRICE_FEEDS\"],\n  description:\n    \"Retrieve price feeds from Pyth Network matching specific criteria\",\n  examples: [\n    [\n      {\n        user: \"user\",\n        name: \"userMessage\",\n        content: {\n          text: \"Get all available price feeds from Pyth Network\",\n          query: \"BTC\",\n          filter: \"USD\",\n        } as GetPriceFeedsContent,\n      } as ActionExample,\n      {\n        user: \"assistant\",\n        name: \"assistantMessage\",\n        content: {\n          text: \"Price feeds matching query BTC and filter USD\",\n          success: true,\n          query: \"BTC\",\n          filter: \"USD\",\n          data: {\n            feeds: [\n              {\n                id: \"f9c0172ba10dfa4d19088d94f5bf61d3b54d5bd7483a322a982e1373ee8ea31b\",\n                attributes: {\n                  asset_type: \"Crypto\",\n                  base: \"BTC\",\n                  description: \"BITCOIN / US DOLLAR\",\n                  display_symbol: \"BTC/USD\",\n                  generic_symbol: \"BTCUSD\",\n                  quote_currency: \"USD\",\n                  schedule: \"America/New_York;O,O,O,O,O,O,O;\",\n                  symbol: \"Crypto.BTC/USD\",\n                },\n              },\n            ],\n          },\n        } as GetPriceFeedsContent,\n      } as ActionExample,\n    ],\n  ],\n\n  async validate(runtime: IAgentRuntime, message: Memory): Promise<boolean> {\n    logGranular(\"Starting validation\", {\n      messageId: message.id,\n      content: message.content,\n    });\n\n    try {\n      // First check if content exists\n      if (!message.content) {\n        logGranular(\"Validation failed: no content\");\n        return false;\n      }\n\n      // Check if this message is intended for this action\n      if (message.content.type !== \"GET_PRICE_FEEDS\") {\n        return true; // Skip validation for other actions\n      }\n\n      const content = message.content as GetPriceFeedsContent;\n      logGranular(\"Validating content structure\", { content });\n\n      // Validate against schema\n      try {\n        await validatePriceFeedsData(content);\n        logGranular(\"Schema validation passed\");\n      } catch (error) {\n        logGranular(\"Schema validation error\", { error });\n        if (error instanceof DataError) {\n          elizaLogger.error(\"Schema validation failed\", {\n            errors: error.details?.errors,\n          });\n          throw error;\n        }\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"Schema validation failed\",\n          ErrorSeverity.HIGH,\n          { error }\n        );\n      }\n\n      // Validate Pyth configuration\n      const config = await validatePythConfig(runtime);\n      logGranular(\"Pyth config validation\", { config });\n\n      if (!config) {\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"Invalid Pyth configuration\",\n          ErrorSeverity.HIGH\n        );\n      }\n\n      // Content validation is optional for this action\n      if (content.query && typeof content.query !== \"string\") {\n        logGranular(\"Invalid query type\", { query: content.query });\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"Query must be a string\",\n          ErrorSeverity.HIGH\n        );\n      }\n\n      if (content.filter && typeof content.filter !== \"string\") {\n        logGranular(\"Invalid filter type\", { filter: content.filter });\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"Filter must be a string\",\n          ErrorSeverity.HIGH\n        );\n      }\n\n      logGranular(\"Validation successful\", {\n        query: content.query,\n        filter: content.filter,\n      });\n\n      return true;\n    } catch (error) {\n      logGranular(\"Validation failed\", {\n        error:\n          error instanceof Error\n            ? {\n                message: error.message,\n                stack: error.stack,\n                name: error.name,\n              }\n            : String(error),\n      });\n\n      return false;\n    }\n  },\n\n  async handler(\n    runtime: IAgentRuntime,\n    message: Memory,\n    state: State | undefined,\n    _options: { [key: string]: unknown } = {},\n    callback?: HandlerCallback\n  ): Promise<boolean> {\n    logGranular(\"Starting handler execution\", {\n      messageId: message.id,\n      hasCallback: !!callback,\n    });\n\n    try {\n      const messageContent = message.content as GetPriceFeedsContent;\n      const { query, filter } = messageContent;\n\n      logGranular(\"Processing request\", { query, filter });\n\n      // Get Pyth configuration\n      const config = await validatePythConfig(runtime);\n      logGranular(\"Got Pyth config\", { networkEnv: config.PYTH_NETWORK_ENV });\n\n      // Initialize HermesClient with configuration\n      const networkConfig = getNetworkConfig(config.PYTH_NETWORK_ENV);\n      logGranular(\"Network config\", { networkConfig });\n\n      const client = new HermesClient(networkConfig.hermes);\n      logGranular(\"Initialized HermesClient\", {\n        endpoint: networkConfig.hermes,\n      });\n\n      // Get price feeds with proper options\n      const options = {\n        query: query,\n        filter: filter,\n      };\n\n      logGranular(\"Fetching price feeds with options\", {\n        options,\n        hermesEndpoint: networkConfig.hermes,\n        clientType: typeof client.getPriceFeeds,\n      });\n\n      const priceFeeds = await client.getPriceFeeds(options);\n\n      // Ensure priceFeeds is an array\n      if (!Array.isArray(priceFeeds)) {\n        throw new Error(\"Invalid response from API: expected array of price feeds\");\n      }\n\n      logGranular(\"Retrieved price feeds\", {\n        responseType: typeof priceFeeds,\n        isArray: Array.isArray(priceFeeds),\n        count: priceFeeds.length,\n        sample: priceFeeds.slice(0, 3), // Log first 3 feeds for debugging\n      });\n\n      // Process and transform feeds\n      const transformedFeeds = priceFeeds.map((feed) => ({\n        id: feed.id,\n        attributes: {\n          asset_type: feed.attributes?.asset_type || \"Unknown\",\n          base: feed.attributes?.base || \"Unknown\",\n          description: feed.attributes?.description || \"Unknown\",\n          display_symbol: feed.attributes?.display_symbol || \"Unknown\",\n          quote_currency: feed.attributes?.quote_currency || \"Unknown\",\n          schedule: feed.attributes?.schedule || \"\",\n          symbol: feed.attributes?.symbol || \"Unknown\",\n          generic_symbol: feed.attributes?.generic_symbol,\n          cms_symbol: feed.attributes?.cms_symbol,\n          country: feed.attributes?.country,\n          cqs_symbol: feed.attributes?.cqs_symbol,\n          nasdaq_symbol: feed.attributes?.nasdaq_symbol,\n          contract_id: feed.attributes?.contract_id,\n        },\n      }));\n\n      // Prepare callback content\n      const callbackContent: GetPriceFeedsContent = {\n        text: `Retrieved ${priceFeeds.length} price feeds:\n${transformedFeeds\n  .map(\n    (feed) =>\n      `- ${feed.attributes.description} (${feed.attributes.display_symbol})\n  Type: ${feed.attributes.asset_type}\n  Base: ${feed.attributes.base}\n  Quote: ${feed.attributes.quote_currency}\n  Schedule: ${feed.attributes.schedule}\n  ID: ${feed.id}`\n  )\n  .join(\"\\n\")}\n${query ? `\\nMatching query: \"${query}\"` : \"\"}${filter ? `\\nWith filter: \"${filter}\"` : \"\"}`,\n        query,\n        filter,\n        success: true,\n        data: {\n          feeds: transformedFeeds,\n          count: priceFeeds.length,\n          responseType: \"object\",\n          isArray: true,\n        },\n      };\n\n      logGranular(\"Prepared callback content\", {\n        feedCount: transformedFeeds.length,\n        firstFeed: transformedFeeds[0],\n      });\n\n      // Execute callback if provided\n      if (callback) {\n        logGranular(\"Executing callback\");\n        await callback(callbackContent);\n        logGranular(\"Callback completed\");\n      }\n\n      return true;\n    } catch (error) {\n      const errorMessage =\n        error instanceof Error ? error.message : \"Unknown error occurred\";\n      const errorStack = error instanceof Error ? error.stack : undefined;\n\n      logGranular(\"Error retrieving price feeds\", {\n        error: errorMessage,\n        stack: errorStack,\n      });\n\n      // Prepare error callback content\n      const errorContent: GetPriceFeedsContent = {\n        text: `Error: ${errorMessage}`,\n        success: false,\n      };\n\n      // Execute callback if provided\n      if (callback) {\n        await callback(errorContent);\n      }\n\n      // Return true to indicate handler completed (even with error)\n      return true;\n    }\n  },\n};\n\nexport default getPriceFeedsAction;\n","export * from \"./base\";\nexport * from \"./websocket\";\nexport * from \"./data\";\nexport * from \"./runtime\";\n","import type { IAgentRuntime } from \"@elizaos/core\";\nimport { z } from \"zod\";\n\n// Environment Variables\nlet ENV = \"mainnet\";\n\n// Pyth Network Configuration\nconst PYTH_NETWORKS = {\n  mainnet: {\n    hermes:\n      process.env.PYTH_MAINNET_HERMES_URL || \"https://hermes.pyth.network\",\n    wss: process.env.PYTH_MAINNET_WSS_URL || \"wss://hermes.pyth.network/ws\",\n    pythnet:\n      process.env.PYTH_MAINNET_PYTHNET_URL || \"https://pythnet.rpcpool.com\",\n    contractRegistry:\n      process.env.PYTH_MAINNET_CONTRACT_REGISTRY ||\n      \"https://pyth.network/developers/price-feed-ids\",\n    programKey:\n      process.env.PYTH_MAINNET_PROGRAM_KEY ||\n      \"FsJ3A3u2vn5cTVofAjvy6y5kwABJAqYWpe4975bi2epH\",\n  },\n  testnet: {\n    hermes:\n      process.env.PYTH_TESTNET_HERMES_URL || \"https://hermes-beta.pyth.network\",\n    wss:\n      process.env.PYTH_TESTNET_WSS_URL || \"wss://hermes-beta.pyth.network/ws\",\n    pythnet:\n      process.env.PYTH_TESTNET_PYTHNET_URL || \"https://api.devnet.solana.com\",\n    contractRegistry:\n      process.env.PYTH_TESTNET_CONTRACT_REGISTRY ||\n      \"https://pyth.network/developers/price-feed-ids#testnet\",\n    programKey:\n      process.env.PYTH_TESTNET_PROGRAM_KEY ||\n      \"FsJ3A3u2vn5cTVofAjvy6y5kwABJAqYWpe4975bi2epH\",\n  },\n} as const;\n\n// // Log environment information\n// elizaLogger.info(\"Environment sources\", {\n//     shellVars: Object.keys(process.env).filter(key => key.startsWith('PYTH_')),\n// });\n\nexport const pythEnvSchema = z.object({\n  PYTH_NETWORK_ENV: z.enum([\"mainnet\", \"testnet\"]).default(\"mainnet\"),\n  PYTH_MAX_RETRIES: z.string().transform(Number).default(\"3\"),\n  PYTH_RETRY_DELAY: z.string().transform(Number).default(\"1000\"),\n  PYTH_TIMEOUT: z.string().transform(Number).default(\"5000\"),\n  PYTH_GRANULAR_LOG: z.boolean().default(true),\n  PYTH_LOG_LEVEL: z.enum([\"error\", \"warn\", \"info\", \"debug\"]).default(\"info\"),\n  RUNTIME_CHECK_MODE: z.boolean().default(false),\n  PYTH_ENABLE_PRICE_STREAMING: z.boolean().default(true),\n  PYTH_MAX_PRICE_STREAMS: z.string().transform(Number).default(\"10\"),\n  PYTH_TEST_ID01: z\n    .string()\n    .default(\n      \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\"\n    ),\n  PYTH_TEST_ID02: z\n    .string()\n    .default(\n      \"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\"\n    ),\n});\n\nexport type PythConfig = z.infer<typeof pythEnvSchema>;\n\nexport function getConfig(\n  env: string | undefined | null = process.env.PYTH_NETWORK_ENV || ENV\n): PythConfig {\n  const network = env || \"mainnet\";\n  ENV = network;\n\n  const maxRetries = process.env.PYTH_MAX_RETRIES\n    ? Number(process.env.PYTH_MAX_RETRIES)\n    : 3;\n  const retryDelay = process.env.PYTH_RETRY_DELAY\n    ? Number(process.env.PYTH_RETRY_DELAY)\n    : 1000;\n  const timeout = process.env.PYTH_TIMEOUT\n    ? Number(process.env.PYTH_TIMEOUT)\n    : 5000;\n  const maxPriceStreams = process.env.PYTH_MAX_PRICE_STREAMS\n    ? Number(process.env.PYTH_MAX_PRICE_STREAMS)\n    : 10;\n\n  return {\n    PYTH_NETWORK_ENV: network as \"mainnet\" | \"testnet\",\n    PYTH_MAX_RETRIES: isNaN(maxRetries) ? 3 : maxRetries,\n    PYTH_RETRY_DELAY: isNaN(retryDelay) ? 1000 : retryDelay,\n    PYTH_TIMEOUT: isNaN(timeout) ? 5000 : timeout,\n    PYTH_GRANULAR_LOG: process.env.PYTH_GRANULAR_LOG === \"true\",\n    PYTH_LOG_LEVEL:\n      (process.env.PYTH_LOG_LEVEL as \"error\" | \"warn\" | \"info\" | \"debug\") ||\n      \"info\",\n    RUNTIME_CHECK_MODE: process.env.RUNTIME_CHECK_MODE === \"true\",\n    PYTH_ENABLE_PRICE_STREAMING:\n      process.env.PYTH_ENABLE_PRICE_STREAMING !== \"false\",\n    PYTH_MAX_PRICE_STREAMS: isNaN(maxPriceStreams) ? 10 : maxPriceStreams,\n    PYTH_TEST_ID01:\n      process.env.PYTH_TEST_ID01 ||\n      \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n    PYTH_TEST_ID02:\n      process.env.PYTH_TEST_ID02 ||\n      \"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\",\n  };\n}\n\nexport async function validatePythConfig(\n  runtime: IAgentRuntime\n): Promise<PythConfig> {\n  try {\n    const networkEnv =\n      runtime.getSetting(\"PYTH_NETWORK_ENV\") ||\n      process.env.PYTH_NETWORK_ENV ||\n      \"mainnet\";\n    const maxRetries =\n      runtime.getSetting(\"PYTH_MAX_RETRIES\") ||\n      process.env.PYTH_MAX_RETRIES ||\n      \"3\";\n    const retryDelay =\n      runtime.getSetting(\"PYTH_RETRY_DELAY\") ||\n      process.env.PYTH_RETRY_DELAY ||\n      \"1000\";\n    const logLevel =\n      runtime.getSetting(\"PYTH_LOG_LEVEL\") ||\n      process.env.PYTH_LOG_LEVEL ||\n      \"info\";\n    const maxPriceStreams =\n      runtime.getSetting(\"PYTH_MAX_PRICE_STREAMS\") ||\n      process.env.PYTH_MAX_PRICE_STREAMS ||\n      \"10\";\n\n    const config = {\n      PYTH_NETWORK_ENV: networkEnv as \"mainnet\" | \"testnet\",\n      PYTH_MAX_RETRIES: isNaN(Number(maxRetries)) ? 3 : Number(maxRetries),\n      PYTH_RETRY_DELAY: isNaN(Number(retryDelay)) ? 1000 : Number(retryDelay),\n      PYTH_TIMEOUT: 5000,\n      PYTH_GRANULAR_LOG: process.env.PYTH_GRANULAR_LOG === \"true\",\n      PYTH_LOG_LEVEL: [\"error\", \"warn\", \"info\", \"debug\"].includes(logLevel)\n        ? (logLevel as \"error\" | \"warn\" | \"info\" | \"debug\")\n        : \"info\",\n      RUNTIME_CHECK_MODE: process.env.RUNTIME_CHECK_MODE === \"true\",\n      PYTH_ENABLE_PRICE_STREAMING:\n        process.env.PYTH_ENABLE_PRICE_STREAMING !== \"false\",\n      PYTH_MAX_PRICE_STREAMS: isNaN(Number(maxPriceStreams))\n        ? 10\n        : Number(maxPriceStreams),\n      PYTH_TEST_ID01:\n        process.env.PYTH_TEST_ID01 ||\n        \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n      PYTH_TEST_ID02:\n        process.env.PYTH_TEST_ID02 ||\n        \"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\",\n    };\n\n    return config;\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    throw new Error(`Failed to validate Pyth configuration: ${errorMessage}`);\n  }\n}\n\n// Export network configurations\nexport const getNetworkConfig = (env: string = ENV) => {\n  const network = env === \"testnet\" ? \"testnet\" : \"mainnet\";\n  const config = PYTH_NETWORKS[network];\n  return {\n    hermes: config.hermes,\n    websocket: config.wss,\n    rpcEndpoint: config.pythnet,\n    contractAddress: config.programKey,\n  };\n};\n","import { z } from \"zod\";\nimport { DataError, ErrorSeverity, DataErrorCode } from \"../error\";\nimport { elizaLogger } from \"@elizaos/core\";\n\n// Schema for price feed attributes\nconst priceFeedAttributesSchema = z.object({\n  asset_type: z.string(),\n  base: z.string(),\n  description: z.string(),\n  display_symbol: z.string(),\n  quote_currency: z.string(),\n  schedule: z.string(),\n  symbol: z.string(),\n  generic_symbol: z.string().optional(),\n  cms_symbol: z.string().optional(),\n  country: z.string().optional(),\n  cqs_symbol: z.string().optional(),\n  nasdaq_symbol: z.string().optional(),\n  contract_id: z.string().optional(),\n});\n\n// Schema for price feeds request\nexport const priceFeedsSchema = z.object({\n  text: z.string(),\n  query: z.string().optional(),\n  filter: z.string().optional(),\n});\n\nexport async function validatePriceFeedsData(content: unknown): Promise<void> {\n  try {\n    const result = await priceFeedsSchema.parseAsync(content);\n    elizaLogger.debug(\"Price feeds validation passed\", { result });\n  } catch (error) {\n    elizaLogger.error(\"Price feeds validation failed\", { error });\n    throw new DataError(\n      DataErrorCode.VALIDATION_FAILED,\n      \"Price feeds validation failed\",\n      ErrorSeverity.HIGH,\n      { error }\n    );\n  }\n}\n","import { type Action, elizaLogger } from \"@elizaos/core\";\nimport type {\n  IAgentRuntime,\n  Memory,\n  State,\n  HandlerCallback,\n  Content,\n  ActionExample,\n} from \"@elizaos/core\";\nimport { HermesClient } from \"@pythnetwork/hermes-client\";\nimport { EventSource } from \"eventsource\";\nimport { DataError, ErrorSeverity, DataErrorCode } from \"../error\";\nimport {\n  validatePythConfig,\n  getNetworkConfig,\n  getConfig,\n} from \"../environment\";\nimport { validatePriceUpdateStreamData } from \"../utils/priceUpdateStreamValidation\";\n\n// Get configuration for granular logging\nconst config = getConfig();\nconst GRANULAR_LOG = config.PYTH_GRANULAR_LOG;\nconst PYTH_MAX_PRICE_STREAMS = Number(config.PYTH_MAX_PRICE_STREAMS);\n\n// Track active streams\nconst activeStreams = new Map<string, EventSource>();\n\n// Enhanced logging helper\nconst logGranular = (message: string, data?: unknown) => {\n  if (GRANULAR_LOG) {\n    elizaLogger.info(`[PriceUpdatesStream] ${message}`, data);\n    console.log(\n      `[PriceUpdatesStream] ${message}`,\n      data ? JSON.stringify(data, null, 2) : \"\"\n    );\n  }\n};\n\n// Add type for price update item\ninterface PriceUpdateItem {\n  id: string;\n  price: {\n    price: string;\n    conf: string;\n    expo: number;\n    publish_time: number;\n  };\n  ema_price: {\n    price: string;\n    conf: string;\n    expo: number;\n    publish_time: number;\n  };\n  metadata?: {\n    slot: number;\n    proof_available_time: number;\n    prev_publish_time: number;\n  };\n}\ninterface GetPriceUpdatesStreamContent extends Content {\n  text: string;\n  priceIds: string[];\n  options?: {\n    encoding?: \"hex\" | \"base64\";\n    parsed?: boolean;\n    allowUnordered?: boolean;\n    benchmarksOnly?: boolean;\n  };\n  success?: boolean;\n  data?: {\n    streamId: string;\n    status: \"connected\" | \"disconnected\" | \"error\";\n    binary?: {\n      encoding: string;\n      data: string[];\n    };\n    parsed?: Array<{\n      id: string;\n      price: {\n        price: string;\n        conf: string;\n        expo: number;\n        publish_time: number;\n      };\n      ema_price: {\n        price: string;\n        conf: string;\n        expo: number;\n        publish_time: number;\n      };\n      metadata?: {\n        slot: number;\n        proof_available_time: number;\n        prev_publish_time: number;\n      };\n    }>;\n    error?: string;\n  };\n}\n\n// Helper function to extract price IDs from text\nfunction extractPriceIds(text: string): string[] {\n  let priceIds: string[] = [];\n\n  // Try to match common price symbols first\n  const symbolMatch = text.match(/(?:BTC|ETH|SOL)\\/USD/g);\n  if (symbolMatch) {\n    const symbolToId: { [key: string]: string } = {\n      \"BTC/USD\":\n        \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n      \"ETH/USD\":\n        \"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\",\n      \"SOL/USD\":\n        \"0xef0d8b6fda2ceba41da15d4095d1da392a0d2f8ed0c6c7bc0f4cfac8c280b56d\",\n    };\n    priceIds = symbolMatch\n      .map((symbol) => symbolToId[symbol])\n      .filter((id) => id);\n  }\n\n  if (priceIds.length === 0) {\n    const hexMatchesWithPrefix = text.match(/0x[0-9a-fA-F]{64}/g);\n    if (hexMatchesWithPrefix) {\n      priceIds = hexMatchesWithPrefix;\n    } else {\n      const hexMatches = text.match(/[0-9a-fA-F]{64}/g);\n      if (hexMatches) {\n        priceIds = hexMatches.map((id) => `0x${id}`);\n      }\n    }\n  }\n\n  return priceIds;\n}\n\n// Define proper types for the processed data\ninterface ProcessedPriceData {\n  binary?: {\n    encoding: string;\n    data: string[];\n  };\n  parsed?: Array<{\n    id: string;\n    price: {\n      price: string;\n      conf: string;\n      expo: number;\n      publish_time: number;\n    };\n    ema_price: {\n      price: string;\n      conf: string;\n      expo: number;\n      publish_time: number;\n    };\n    metadata?: {\n      slot: number;\n      proof_available_time: number;\n      prev_publish_time: number;\n    };\n  }>;\n}\n\ninterface RawPriceData {\n  binary: {\n    encoding: string;\n    data: string[];\n  };\n  parsed: Array<PriceUpdateItem>;\n}\n\n// Helper function to process price update data\nfunction processPriceUpdateData(data: RawPriceData): ProcessedPriceData {\n  return {\n    binary: data.binary,\n    parsed: data.parsed.map((item: PriceUpdateItem) => ({\n      id: item.id,\n      price: {\n        price: item.price.price,\n        conf: item.price.conf,\n        expo: item.price.expo,\n        publish_time: item.price.publish_time,\n      },\n      ema_price: {\n        price: item.ema_price.price,\n        conf: item.ema_price.conf,\n        expo: item.ema_price.expo,\n        publish_time: item.ema_price.publish_time,\n      },\n      metadata: item.metadata\n        ? {\n            slot: item.metadata.slot,\n            proof_available_time: item.metadata.proof_available_time,\n            prev_publish_time: item.metadata.prev_publish_time,\n          }\n        : undefined,\n    })),\n  };\n}\n\n// Helper function to format price update text\nfunction formatPriceUpdateText(\n  streamId: string,\n  messageCount: number,\n  data: RawPriceData\n): string {\n  return `Price Update Stream (ID: stream_${streamId}, Update ${messageCount}/${PYTH_MAX_PRICE_STREAMS}):\n${data.parsed\n  .map(\n    (item: PriceUpdateItem) =>\n      `Price Feed: ${item.id}\nCurrent Price: ${(Number(item.price.price) * Math.pow(10, item.price.expo)).toFixed(2)} USD\nConfidence: ±${(Number(item.price.conf) * Math.pow(10, item.price.expo)).toFixed(2)} USD\nEMA Price: ${(Number(item.ema_price.price) * Math.pow(10, item.ema_price.expo)).toFixed(2)} USD\nEMA Confidence: ±${(Number(item.ema_price.conf) * Math.pow(10, item.ema_price.expo)).toFixed(2)} USD\nLast Update: ${new Date(item.price.publish_time * 1000).toLocaleString()}${\n        item.metadata\n          ? `\nSlot: ${item.metadata.slot}\nProof Available: ${new Date(item.metadata.proof_available_time * 1000).toLocaleString()}`\n          : \"\"\n      }`\n  )\n  .join(\"\\n\\n\")}`;\n}\n\n// Function to collect stream data\nasync function collectStreamData(\n  eventSource: EventSource,\n  streamId: string\n): Promise<RawPriceData> {\n  return new Promise((resolve, reject) => {\n    let messageCount = 0;\n    const collectedData: RawPriceData = {\n      binary: { encoding: \"hex\", data: [] },\n      parsed: [],\n    };\n\n    eventSource.onmessage = (event) => {\n      messageCount++;\n      logGranular(\"Received price update\", {\n        streamId,\n        messageCount,\n        data: event.data,\n      });\n\n      try {\n        const rawData = JSON.parse(event.data) as RawPriceData;\n        collectedData.binary.data.push(...rawData.binary.data);\n        collectedData.parsed.push(...rawData.parsed);\n\n        if (messageCount >= PYTH_MAX_PRICE_STREAMS) {\n          eventSource.close();\n          resolve(collectedData);\n        }\n      } catch (error) {\n        eventSource.close();\n        reject(error);\n      }\n    };\n\n    eventSource.onerror = (error) => {\n      eventSource.close();\n      reject(error);\n    };\n  });\n}\n\n// Helper function to create and manage price stream\nasync function createPriceStream(\n  runtime: IAgentRuntime,\n  priceIds: string[],\n  callback?: HandlerCallback\n): Promise<void> {\n  const config = await validatePythConfig(runtime);\n  if (!config) {\n    throw new DataError(\n      DataErrorCode.VALIDATION_FAILED,\n      \"Invalid Pyth configuration\",\n      ErrorSeverity.HIGH\n    );\n  }\n\n  const networkConfig = getNetworkConfig(config.PYTH_NETWORK_ENV);\n  const client = new HermesClient(networkConfig.hermes);\n  const streamId = `stream_${Date.now()}`;\n\n  logGranular(\"Creating price stream for IDs:\", { streamId, priceIds });\n\n  try {\n    // Create streaming URL with price IDs\n    const params = new URLSearchParams();\n    priceIds.forEach((id) => params.append(\"ids[]\", id));\n    params.append(\"parsed\", \"true\");\n    params.append(\"encoding\", \"hex\");\n\n    const streamUrl = `${networkConfig.hermes}/v2/updates/price/stream?${params.toString()}`;\n    const eventSource = new EventSource(streamUrl);\n\n    // Store the stream\n    activeStreams.set(streamId, eventSource);\n\n    try {\n      // Collect all stream data\n      const collectedData = await collectStreamData(\n        eventSource as any,\n        streamId\n      );\n\n      // Process collected data\n      const processedData = processPriceUpdateData(collectedData);\n      const updateText = formatPriceUpdateText(\n        streamId,\n        PYTH_MAX_PRICE_STREAMS,\n        collectedData\n      );\n\n      // Send single callback with all data\n      if (callback) {\n        callback({\n          text: updateText,\n          success: true,\n          priceIds,\n          data: {\n            streamId,\n            status: \"connected\",\n            ...processedData,\n          },\n        } as GetPriceUpdatesStreamContent);\n      }\n\n      activeStreams.delete(streamId);\n      logGranular(\"Stream completed successfully\", { streamId });\n    } catch (error) {\n      logGranular(\"Error collecting stream data\", { streamId, error });\n      if (callback) {\n        callback({\n          text: `Error processing price updates: ${error instanceof Error ? error.message : String(error)}`,\n          success: false,\n          priceIds,\n          data: {\n            streamId,\n            status: \"error\",\n            error: error instanceof Error ? error.message : String(error),\n          },\n        } as GetPriceUpdatesStreamContent);\n      }\n      activeStreams.delete(streamId);\n      throw error;\n    }\n  } catch (error) {\n    logGranular(\"Error creating price stream\", { streamId, error });\n    throw new DataError(\n      DataErrorCode.TRANSFORM_ERROR,\n      error instanceof Error ? error.message : String(error),\n      ErrorSeverity.HIGH\n    );\n  }\n}\n\nexport const getPriceUpdatesStreamAction: Action = {\n  name: \"GET_PRICE_UPDATES_STREAM\",\n  similes: [\"STREAM_PRICE_UPDATES\", \"SUBSCRIBE_TO_PRICES\", \"WATCH_PRICE_FEED\"],\n  description:\n    \"Create a streaming connection for real-time price updates from Pyth Network\",\n  examples: [\n    [\n      {\n        user: \"user\",\n        name: \"userMessage\",\n        content: {\n          text: \"Stream BTC/USD price updates\",\n          priceIds: [\n            \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n          ],\n          options: {\n            encoding: \"hex\",\n            parsed: true,\n            benchmarksOnly: true,\n          },\n        } as GetPriceUpdatesStreamContent,\n      } as ActionExample,\n      {\n        user: \"assistant\",\n        name: \"assistantMessage\",\n        content: {\n          text: \"Starting BTC/USD price stream...\",\n          success: true,\n          priceIds: [\n            \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n          ],\n          data: {\n            streamId: \"stream_1\",\n            status: \"connected\",\n            updates: [\n              {\n                id: \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n                price: 42000,\n                confidence: 100,\n                timestamp: 1641034800,\n                emaPrice: 41950,\n              },\n            ],\n          },\n        } as GetPriceUpdatesStreamContent,\n      } as ActionExample,\n    ],\n    [\n      {\n        user: \"user\",\n        name: \"userMessage\",\n        content: {\n          text: \"Stream ETH and BTC prices with benchmarks only\",\n          priceIds: [\n            \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n            \"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\",\n          ],\n          options: {\n            benchmarksOnly: true,\n            parsed: true,\n          },\n        } as GetPriceUpdatesStreamContent,\n      } as ActionExample,\n      {\n        user: \"assistant\",\n        name: \"assistantMessage\",\n        content: {\n          text: \"Starting price stream for BTC and ETH...\",\n          success: true,\n          priceIds: [\n            \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n            \"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\",\n          ],\n          data: {\n            streamId: \"stream_2\",\n            status: \"connected\",\n            updates: [\n              {\n                id: \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n                price: 42000,\n                confidence: 100,\n                timestamp: 1641034800,\n                emaPrice: 41950,\n              },\n              {\n                id: \"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\",\n                price: 2500,\n                confidence: 50,\n                timestamp: 1641034800,\n                emaPrice: 2495,\n              },\n            ],\n          },\n        } as GetPriceUpdatesStreamContent,\n      } as ActionExample,\n    ],\n  ],\n\n  validate: async (\n    _runtime: IAgentRuntime,\n    message: Memory\n  ): Promise<boolean> => {\n    // Check if this message is intended for this action\n    if (message.content?.type !== \"GET_PRICE_UPDATES_STREAM\") {\n      return true; // Skip validation for other actions\n    }\n\n    logGranular(\"Starting validation\", {\n      content: message.content,\n    });\n\n    try {\n      let content = message.content as GetPriceUpdatesStreamContent;\n\n      // Handle text-only input by extracting priceIds\n      if (!content.priceIds) {\n        const priceIds = extractPriceIds(content.text);\n        if (priceIds.length > 0) {\n          content = {\n            ...content,\n            priceIds,\n            options: {\n              parsed: true,\n              encoding: \"hex\",\n            },\n          };\n          message.content = content;\n        }\n      }\n\n      // Validate against schema\n      try {\n        await validatePriceUpdateStreamData(content);\n        logGranular(\"Schema validation passed\");\n      } catch (error) {\n        logGranular(\"Schema validation failed\", { error });\n        if (error instanceof DataError) {\n          elizaLogger.error(\"Schema validation failed\", {\n            errors: error.details?.errors,\n          });\n        }\n        return false;\n      }\n\n      // Validate Pyth configuration\n      const config = await validatePythConfig(_runtime);\n      if (!config) {\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"Invalid Pyth configuration\",\n          ErrorSeverity.HIGH\n        );\n      }\n\n      if (!content.priceIds || !Array.isArray(content.priceIds)) {\n        throw DataError.validationFailed(content, [\n          \"priceIds must be an array of strings\",\n        ]);\n      }\n\n      if (content.priceIds.length === 0) {\n        throw DataError.validationFailed(content, [\n          \"priceIds array cannot be empty\",\n        ]);\n      }\n\n      // Validate each price ID is a valid hex string\n      content.priceIds.forEach((id, index) => {\n        if (!/^0x[0-9a-fA-F]{64}$/.test(id)) {\n          throw DataError.validationFailed(content, [\n            `Invalid price ID at index ${index}: ${id}`,\n          ]);\n        }\n      });\n\n      // Validate options if provided\n      if (content.options) {\n        const { encoding, parsed, allowUnordered, benchmarksOnly } =\n          content.options;\n\n        if (encoding && ![\"hex\", \"base64\"].includes(encoding)) {\n          throw DataError.validationFailed(content, [\n            \"encoding must be either 'hex' or 'base64'\",\n          ]);\n        }\n\n        if (parsed !== undefined && typeof parsed !== \"boolean\") {\n          throw DataError.validationFailed(content, [\n            \"parsed must be a boolean\",\n          ]);\n        }\n\n        if (\n          allowUnordered !== undefined &&\n          typeof allowUnordered !== \"boolean\"\n        ) {\n          throw DataError.validationFailed(content, [\n            \"allowUnordered must be a boolean\",\n          ]);\n        }\n\n        if (\n          benchmarksOnly !== undefined &&\n          typeof benchmarksOnly !== \"boolean\"\n        ) {\n          throw DataError.validationFailed(content, [\n            \"benchmarksOnly must be a boolean\",\n          ]);\n        }\n      }\n\n      logGranular(\"GET_PRICE_UPDATES_STREAM validation successful\", {\n        priceIds: content.priceIds,\n        options: content.options,\n      });\n\n      return true;\n    } catch (error) {\n      logGranular(\"Validation failed\", { error });\n      return false;\n    }\n  },\n\n  async handler(\n    runtime: IAgentRuntime,\n    message: Memory,\n    state: State | undefined,\n    _options: { [key: string]: unknown } = {},\n    callback?: HandlerCallback\n  ): Promise<boolean> {\n    logGranular(\"Starting handler execution\", {\n      messageId: message.id,\n      messageContent: message.content,\n    });\n\n    try {\n      const messageContent = message.content as GetPriceUpdatesStreamContent;\n      let priceIds = messageContent.priceIds;\n\n      // If no priceIds in content, try to extract them\n      if (!priceIds) {\n        priceIds = extractPriceIds(messageContent.text);\n        if (priceIds.length === 0) {\n          throw new DataError(\n            DataErrorCode.VALIDATION_FAILED,\n            \"Could not extract any valid price IDs from message\",\n            ErrorSeverity.HIGH\n          );\n        }\n      }\n\n      await createPriceStream(runtime, priceIds, callback);\n      return true;\n    } catch (error) {\n      logGranular(\"Error in price updates stream handler\", error);\n      throw new DataError(\n        DataErrorCode.TRANSFORM_ERROR,\n        error instanceof Error ? error.message : String(error),\n        ErrorSeverity.HIGH\n      );\n    }\n  },\n};\n\nexport default getPriceUpdatesStreamAction;\n","import { z } from \"zod\";\nimport { DataError, ErrorSeverity, DataErrorCode } from \"../error\";\nimport { elizaLogger } from \"@elizaos/core\";\n\n// Schema for price update stream options\nconst streamOptionsSchema = z.object({\n  encoding: z.enum([\"hex\", \"base64\"]).optional(),\n  parsed: z.boolean().optional(),\n  allowUnordered: z.boolean().optional(),\n  benchmarksOnly: z.boolean().optional(),\n});\n\n// Schema for price metadata\nconst priceMetadataSchema = z.object({\n  slot: z.number(),\n  proof_available_time: z.number(),\n  prev_publish_time: z.number(),\n});\n\n// Schema for price data\nconst priceDataSchema = z.object({\n  price: z.string(),\n  conf: z.string(),\n  expo: z.number(),\n  publish_time: z.number(),\n});\n\n// Schema for parsed price update\nconst parsedPriceUpdateSchema = z.object({\n  id: z.string(),\n  price: priceDataSchema,\n  ema_price: priceDataSchema,\n  metadata: priceMetadataSchema.optional(),\n});\n\n// Schema for binary data\nconst binaryDataSchema = z.object({\n  encoding: z.string(),\n  data: z.array(z.string()),\n});\n\n// Schema for price updates stream request\nexport const priceUpdateStreamSchema = z.object({\n  text: z.string(),\n  priceIds: z.array(z.string()).optional(),\n  options: streamOptionsSchema.optional(),\n});\n\nexport async function validatePriceUpdateStreamData(\n  content: unknown\n): Promise<void> {\n  try {\n    const result = await priceUpdateStreamSchema.parseAsync(content);\n    elizaLogger.debug(\"Price update stream validation passed\", { result });\n  } catch (error) {\n    elizaLogger.error(\"Price update stream validation failed\", { error });\n    throw new DataError(\n      DataErrorCode.VALIDATION_FAILED,\n      \"Price update stream validation failed\",\n      ErrorSeverity.HIGH,\n      { error }\n    );\n  }\n}\n","import { type Action, elizaLogger } from \"@elizaos/core\";\nimport type {\n  IAgentRuntime,\n  Memory,\n  State,\n  HandlerCallback,\n  Content,\n  ActionExample,\n} from \"@elizaos/core\";\n// import { HermesClient } from \"../hermes/HermesClient\";\nimport { HermesClient } from \"@pythnetwork/hermes-client\";\nimport { DataError, ErrorSeverity, DataErrorCode } from \"../error\";\nimport {\n  validatePythConfig,\n  getNetworkConfig,\n  getConfig,\n} from \"../environment\";\nimport { validatePriceUpdatesData } from \"../utils/priceUpdatesValidation\";\n\n// Get configuration for granular logging\nconst config = getConfig();\nconst GRANULAR_LOG = config.PYTH_GRANULAR_LOG;\n\n// Enhanced logging helper\nconst logGranular = (message: string, data?: unknown) => {\n  if (GRANULAR_LOG) {\n    elizaLogger.info(`[PriceUpdates] ${message}`, data);\n    console.log(\n      `[PriceUpdates] ${message}`,\n      data ? JSON.stringify(data, null, 2) : \"\"\n    );\n  }\n};\n\n// Helper function to normalize price feed IDs\nconst normalizePriceFeedId = (id: string): string => {\n  // Ensure 0x prefix and lowercase\n  return id.toLowerCase().startsWith(\"0x\")\n    ? id.toLowerCase()\n    : `0x${id.toLowerCase()}`;\n};\n\n// Helper function to format price feed ID for display\nconst formatPriceFeedId = (id: string): string => {\n  // Add '0x' prefix if not present\n  return id.toLowerCase().startsWith(\"0x\")\n    ? id.toLowerCase()\n    : `0x${id.toLowerCase()}`;\n};\n\ninterface GetLatestPriceUpdatesContent extends Content {\n  text: string;\n  priceIds: string[];\n  options?: {\n    encoding?: \"hex\" | \"base64\";\n    parsed?: boolean;\n  };\n  success?: boolean;\n  data?: {\n    updates?: Array<{\n      price_feed_id: string;\n      price: number;\n      conf: number;\n      expo: number;\n      publish_time: number;\n      ema_price?: {\n        price: number;\n        conf: number;\n        expo: number;\n      };\n    }>;\n    error?: string;\n  };\n}\n\nexport const getLatestPriceUpdatesAction: Action = {\n  name: \"GET_LATEST_PRICE_UPDATES\",\n  similes: [\"FETCH_LATEST_PRICES\", \"GET_CURRENT_PRICES\", \"CHECK_PRICE_FEED\"],\n  description: \"Retrieve latest price updates from Pyth Network\",\n  examples: [\n    [\n      {\n        user: \"user\",\n        name: \"userMessage\",\n        content: {\n          text: \"Get latest price updates for 0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n          priceIds: [\n            \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n          ],\n          options: {\n            encoding: \"base64\",\n            parsed: true,\n          },\n        } as GetLatestPriceUpdatesContent,\n      } as ActionExample,\n      {\n        user: \"assistant\",\n        name: \"assistantMessage\",\n        content: {\n          text: \"Here is the latest BTC/USD price\",\n          success: true,\n          priceIds: [\n            \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n          ],\n          data: {\n            updates: [\n              {\n                price_feed_id:\n                  \"0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43\",\n                price: 42000000000,\n                conf: 100000000,\n                expo: -8,\n                publish_time: 1641034800,\n                ema_price: {\n                  price: 41950000000,\n                  conf: 95000000,\n                  expo: -8,\n                },\n              },\n            ],\n          },\n        } as GetLatestPriceUpdatesContent,\n      } as ActionExample,\n    ],\n  ],\n\n  validate: async (\n    _runtime: IAgentRuntime,\n    message: Memory\n  ): Promise<boolean> => {\n    // Check if this message is intended for this action\n    if (message.content?.type !== \"GET_LATEST_PRICE_UPDATES\") {\n      return true; // Skip validation for other actions\n    }\n\n    logGranular(\"Validating GET_LATEST_PRICE_UPDATES action\", {\n      content: message.content,\n    });\n\n    try {\n      const content = message.content as GetLatestPriceUpdatesContent;\n\n      // Extract priceIds from text if not provided directly\n      if (!content.priceIds && content.text) {\n        const match = content.text.match(/([a-fA-F0-9]{64})/);\n        if (match) {\n          content.priceIds = [formatPriceFeedId(match[1])];\n        }\n      }\n\n      // Normalize all price feed IDs\n      if (content.priceIds) {\n        content.priceIds = content.priceIds.map(normalizePriceFeedId);\n      }\n\n      // Use the new validation function\n      try {\n        await validatePriceUpdatesData(content);\n        logGranular(\"Schema validation passed\");\n      } catch (error) {\n        logGranular(\"Schema validation failed\", { error });\n        if (error instanceof DataError) {\n          elizaLogger.error(\"Schema validation failed\", {\n            errors: error.details?.errors,\n          });\n          throw error;\n        }\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"Schema validation failed\",\n          ErrorSeverity.HIGH,\n          { error }\n        );\n      }\n\n      // Keep existing validation as additional checks\n      if (!content.priceIds || !Array.isArray(content.priceIds)) {\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"priceIds must be an array of strings\",\n          ErrorSeverity.HIGH\n        );\n      }\n\n      if (content.priceIds.length === 0) {\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"priceIds array cannot be empty\",\n          ErrorSeverity.HIGH\n        );\n      }\n\n      // Validate each price ID is a valid hex string\n      content.priceIds.forEach((id, index) => {\n        const cleanId = id.startsWith(\"0x\") ? id.slice(2) : id;\n        if (!/^[0-9a-fA-F]{64}$/.test(cleanId)) {\n          throw new DataError(\n            DataErrorCode.VALIDATION_FAILED,\n            `Invalid price ID at index ${index}: ${id}. Must be a 64-character hex string`,\n            ErrorSeverity.HIGH\n          );\n        }\n      });\n\n      // Validate options if provided\n      if (content.options) {\n        if (\n          content.options.encoding &&\n          ![\"hex\", \"base64\"].includes(content.options.encoding)\n        ) {\n          throw new DataError(\n            DataErrorCode.VALIDATION_FAILED,\n            \"Invalid encoding option. Must be 'hex' or 'base64'\",\n            ErrorSeverity.HIGH\n          );\n        }\n      }\n\n      return true;\n    } catch (error) {\n      logGranular(\"Validation failed\", { error });\n      elizaLogger.error(\"Validation failed for GET_LATEST_PRICE_UPDATES\", {\n        error: error instanceof Error ? error.message : String(error),\n      });\n      return false;\n    }\n  },\n\n  handler: async (\n    runtime: IAgentRuntime,\n    message: Memory,\n    _state?: State,\n    _options: { [key: string]: unknown } = {},\n    callback?: HandlerCallback\n  ): Promise<boolean> => {\n    logGranular(\"Executing GET_LATEST_PRICE_UPDATES action\");\n\n    try {\n      const messageContent = message.content as GetLatestPriceUpdatesContent;\n\n      // Log the full message content\n      logGranular(\"Message content received\", messageContent);\n\n      // Extract priceIds from text if not provided directly\n      if (!messageContent.priceIds && messageContent.text) {\n        const match = messageContent.text.match(/([a-fA-F0-9]{64})/);\n        if (match) {\n          messageContent.priceIds = [formatPriceFeedId(match[1])];\n        }\n      }\n\n      // Normalize all price feed IDs\n      if (messageContent.priceIds) {\n        messageContent.priceIds =\n          messageContent.priceIds.map(normalizePriceFeedId);\n      }\n\n      const { priceIds, options = {} } = messageContent;\n\n      // Log extracted values\n      logGranular(\"Extracted values\", {\n        priceIds,\n        options,\n      });\n\n      // Get Pyth configuration\n      const config = await validatePythConfig(runtime);\n      if (!config) {\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"Invalid Pyth configuration\",\n          ErrorSeverity.HIGH\n        );\n      }\n\n      // Get network configuration\n      const networkConfig = getNetworkConfig(config.PYTH_NETWORK_ENV);\n      const hermesClient = new HermesClient(networkConfig.hermes);\n\n      logGranular(\"Initialized HermesClient\", {\n        endpoint: networkConfig.hermes,\n      });\n\n      try {\n        // Log the request details\n        logGranular(\"Requesting price updates with params\", {\n          priceIds,\n          options,\n        });\n\n        // Get latest price updates\n        const updates = await hermesClient.getLatestPriceUpdates(priceIds, {\n          parsed: true,\n          encoding: options?.encoding as \"hex\" | \"base64\" | undefined,\n        });\n\n        // Log the raw response\n        logGranular(\"Raw response from Hermes\", {\n          updates,\n        });\n\n        if (!updates || !updates.parsed) {\n          throw new Error(\"No updates received from Hermes\");\n        }\n\n        logGranular(\"Successfully retrieved price updates\", {\n          updates,\n          parsedCount: updates.parsed?.length,\n        });\n\n        if (callback) {\n          const formattedText = updates.parsed\n            ?.map((update) => {\n              const metadata = update.metadata;\n              const proofTime = metadata?.proof_available_time;\n              return `Price Feed: ${normalizePriceFeedId(update.id)}\nCurrent Price: ${(Number(update.price.price) * Math.pow(10, update.price.expo)).toFixed(2)} USD\nConfidence: ±${(Number(update.price.conf) * Math.pow(10, update.price.expo)).toFixed(2)} USD\nEMA Price: ${(Number(update.ema_price.price) * Math.pow(10, update.ema_price.expo)).toFixed(2)} USD\nEMA Confidence: ±${(Number(update.ema_price.conf) * Math.pow(10, update.ema_price.expo)).toFixed(2)} USD\nLast Update: ${new Date(update.price.publish_time * 1000).toLocaleString()}${\n                metadata\n                  ? `\nSlot: ${metadata.slot}\nProof Available: ${proofTime ? new Date(proofTime * 1000).toLocaleString() : \"Not available\"}`\n                  : \"\"\n              }`;\n            })\n            .join(\"\\n\\n\");\n\n          callback({\n            text: formattedText,\n            success: true,\n            priceIds,\n            data: {\n              updates: updates.parsed?.map((update) => ({\n                price_feed_id: normalizePriceFeedId(update.id),\n                price: Number(update.price.price),\n                conf: Number(update.price.conf),\n                expo: update.price.expo,\n                publish_time: update.price.publish_time,\n                ema_price: update.ema_price\n                  ? {\n                      price: Number(update.ema_price.price),\n                      conf: Number(update.ema_price.conf),\n                      expo: update.ema_price.expo,\n                    }\n                  : undefined,\n                metadata: update.metadata,\n              })),\n            },\n          } as GetLatestPriceUpdatesContent);\n        }\n\n        return true;\n      } catch (error) {\n        logGranular(\"Failed to process price updates request\", { error });\n        if (callback) {\n          callback({\n            text: `Error retrieving price updates: ${error instanceof Error ? error.message : String(error)}`,\n            success: false,\n            priceIds,\n            data: {\n              error: error instanceof Error ? error.message : String(error),\n            },\n          } as GetLatestPriceUpdatesContent);\n        }\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"Failed to process price updates request\",\n          ErrorSeverity.HIGH,\n          { originalError: error }\n        );\n      }\n    } catch (error) {\n      logGranular(\"Failed to get latest price updates\", { error });\n      throw new DataError(\n        DataErrorCode.NETWORK_ERROR,\n        \"Failed to get latest price updates\",\n        ErrorSeverity.HIGH,\n        { originalError: error }\n      );\n    }\n  },\n};\n\nexport default getLatestPriceUpdatesAction;\n","import { elizaLogger } from \"@elizaos/core\";\nimport { DataError, PythErrorCode, ErrorSeverity } from \"../error\";\nimport Ajv, { type ErrorObject } from \"ajv\";\n\nconst ajv = new Ajv({\n  allErrors: true,\n  verbose: true,\n  coerceTypes: false,\n  useDefaults: true,\n});\n\n// Price updates schema\nexport const priceUpdatesSchema = {\n  type: \"object\",\n  required: [\"priceIds\"],\n  properties: {\n    text: { type: \"string\" },\n    priceIds: {\n      type: \"array\",\n      items: {\n        type: \"string\",\n        pattern: \"^(0x)?[0-9a-fA-F]+$\",\n      },\n      minItems: 1,\n      description: \"Array of price feed IDs to fetch updates for\",\n    },\n    options: {\n      type: \"object\",\n      properties: {\n        encoding: {\n          type: \"string\",\n          enum: [\"hex\", \"base64\"],\n          description: \"Encoding format for the price updates\",\n        },\n        parsed: {\n          type: \"boolean\",\n          description: \"Whether to return parsed price updates\",\n        },\n      },\n    },\n  },\n};\n\n/**\n * Validates price updates data against the schema\n * @param data Data to validate\n * @returns Promise<boolean> True if validation succeeds\n * @throws DataError if validation fails\n */\nexport async function validatePriceUpdatesData(data: unknown): Promise<void> {\n  try {\n    const validate = ajv.compile(priceUpdatesSchema);\n    const valid = validate(data);\n\n    if (!valid) {\n      const errors = validate.errors || [];\n      elizaLogger.error(\"Price updates validation failed\", {\n        errors,\n        data,\n      });\n\n      throw new DataError(\n        PythErrorCode.DATA_VALIDATION_FAILED,\n        \"Price updates validation failed\",\n        ErrorSeverity.HIGH,\n        {\n          errors: errors.map((err: ErrorObject) => ({\n            path: err.schemaPath,\n            message: err.message,\n            params: err.params,\n          })),\n          data,\n        }\n      );\n    }\n\n    // Validation passed\n  } catch (error) {\n    if (error instanceof DataError) {\n      throw error;\n    }\n\n    elizaLogger.error(\"Price updates validation error\", {\n      error: error instanceof Error ? error.message : String(error),\n      data,\n    });\n\n    throw new DataError(\n      PythErrorCode.DATA_SCHEMA_ERROR,\n      \"Price updates validation error\",\n      ErrorSeverity.HIGH,\n      {\n        error: error instanceof Error ? error.message : String(error),\n        data,\n      }\n    );\n  }\n}\n\n/**\n * Validates a price ID format\n * @param priceId Price ID to validate\n * @returns boolean True if price ID is valid\n */\nexport function validatePriceId(priceId: string): boolean {\n  return /^(0x)?[0-9a-fA-F]+$/.test(priceId);\n}\n","import { type Action, elizaLogger } from \"@elizaos/core\";\nimport type {\n  IAgentRuntime,\n  Memory,\n  State,\n  HandlerCallback,\n  Content,\n  ActionExample,\n} from \"@elizaos/core\";\n// import { HermesClient } from \"../hermes/HermesClient\";\nimport { HermesClient } from \"@pythnetwork/hermes-client\";\nimport { DataError, ErrorSeverity, DataErrorCode } from \"../error\";\nimport {\n  validatePythConfig,\n  getNetworkConfig,\n  getConfig,\n} from \"../environment\";\nimport { validatePublisherCapsData } from \"../utils/publisherCapsValidation\";\n\n// Get configuration for granular logging\nconst config = getConfig();\nconst GRANULAR_LOG = config.PYTH_GRANULAR_LOG;\n\n// Enhanced logging helper\nconst logGranular = (message: string, data?: unknown) => {\n  if (GRANULAR_LOG) {\n    elizaLogger.info(`[PublisherCaps] ${message}`, data);\n    console.log(\n      `[PublisherCaps] ${message}`,\n      data ? JSON.stringify(data, null, 2) : \"\"\n    );\n  }\n};\n\ninterface GetLatestPublisherCapsContent extends Content {\n  text: string;\n  success?: boolean;\n  data?: {\n    caps?: Array<{\n      publisher: string;\n      cap: number;\n      timestamp: number;\n    }>;\n    count?: number;\n    error?: string;\n  };\n}\n\nexport const getLatestPublisherCapsAction: Action = {\n  name: \"GET_LATEST_PUBLISHER_CAPS\",\n  similes: [\n    \"FETCH_PUBLISHER_CAPS\",\n    \"GET_PUBLISHER_LIMITS\",\n    \"CHECK_PUBLISHER_CAPS\",\n  ],\n  description: \"Retrieve latest publisher caps from Pyth Network\",\n  examples: [\n    [\n      {\n        user: \"user\",\n        name: \"userMessage\",\n        content: {\n          text: \"Get me all the latest publisher caps\",\n        } as GetLatestPublisherCapsContent,\n      } as ActionExample,\n      {\n        user: \"assistant\",\n        name: \"assistantMessage\",\n        content: {\n          text: \"Latest publisher caps\",\n          success: true,\n          data: {\n            caps: [\n              {\n                publisher: \"0x1234567890abcdef1234567890abcdef12345678\",\n                cap: 1000000,\n                timestamp: 1641034800,\n              },\n            ],\n          },\n        } as GetLatestPublisherCapsContent,\n      } as ActionExample,\n    ],\n  ],\n\n  validate: async (\n    _runtime: IAgentRuntime,\n    message: Memory\n  ): Promise<boolean> => {\n    logGranular(\"Validating GET_LATEST_PUBLISHER_CAPS action\", {\n      content: message.content,\n    });\n\n    try {\n      // First check if content exists\n      if (!message.content) {\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"Message content is required\",\n          ErrorSeverity.HIGH\n        );\n      }\n\n      // Check if this message is intended for this action\n      if (message.content.type !== \"GET_LATEST_PUBLISHER_CAPS\") {\n        return true; // Skip validation for other actions\n      }\n\n      const content = message.content as GetLatestPublisherCapsContent;\n\n      // Use the new validation function\n      try {\n        await validatePublisherCapsData(content);\n        logGranular(\"Publisher caps validation passed\");\n      } catch (error) {\n        logGranular(\"Publisher caps validation failed\", { error });\n        if (error instanceof DataError) {\n          elizaLogger.error(\"Publisher caps validation failed\", {\n            errors: error.details?.errors,\n          });\n          throw error;\n        }\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"Publisher caps validation failed\",\n          ErrorSeverity.HIGH,\n          { error }\n        );\n      }\n\n      return true;\n    } catch (error) {\n      logGranular(\"Validation failed\", { error });\n      elizaLogger.error(\"Validation failed for GET_LATEST_PUBLISHER_CAPS\", {\n        error: error instanceof Error ? error.message : String(error),\n      });\n      return false;\n    }\n  },\n\n  handler: async (\n    runtime: IAgentRuntime,\n    message: Memory,\n    _state?: State,\n    _options: { [key: string]: unknown } = {},\n    callback?: HandlerCallback\n  ): Promise<boolean> => {\n    logGranular(\"Executing GET_LATEST_PUBLISHER_CAPS action\");\n\n    try {\n      // Get Pyth configuration\n      const config = await validatePythConfig(runtime);\n      if (!config) {\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"Invalid Pyth configuration\",\n          ErrorSeverity.HIGH\n        );\n      }\n\n      // Get network configuration\n      const networkConfig = getNetworkConfig(config.PYTH_NETWORK_ENV);\n\n      // Initialize Hermes client\n      const hermesClient = new HermesClient(networkConfig.hermes);\n\n      logGranular(\"Initialized HermesClient\", {\n        endpoint: networkConfig.hermes,\n      });\n\n      try {\n        // Get publisher caps with options\n        const response = await hermesClient.getLatestPublisherCaps({\n          parsed: true,\n        });\n\n        if (!response.parsed?.[0]?.publisher_stake_caps) {\n          throw new DataError(\n            DataErrorCode.VALIDATION_FAILED,\n            \"No publisher caps data found in response\",\n            ErrorSeverity.HIGH\n          );\n        }\n\n        const publisherCaps = response.parsed[0].publisher_stake_caps;\n        const currentTimestamp = Date.now();\n\n        // Enhanced logging for each publisher cap\n        publisherCaps.forEach((cap, index) => {\n          logGranular(`Publisher Cap ${index + 1}`, {\n            publisher: cap.publisher,\n            cap: cap.cap.toLocaleString(),\n            timestamp: new Date(currentTimestamp).toLocaleString(),\n          });\n        });\n\n        logGranular(\"Successfully retrieved publisher caps\", {\n          totalCaps: publisherCaps.length,\n          allCaps: publisherCaps.map((cap) => ({\n            publisher: cap.publisher,\n            cap: cap.cap.toLocaleString(),\n            timestamp: new Date(currentTimestamp).toLocaleString(),\n          })),\n        });\n\n        // Format the publisher caps into text\n        const formattedText = publisherCaps.length === 0\n          ? \"No publisher caps found\"\n          : publisherCaps\n              .map(\n                (cap, index) =>\n                  `Publisher ${index + 1}:\nID: ${cap.publisher}\nCap: ${cap.cap.toLocaleString()} tokens\nTimestamp: ${new Date(currentTimestamp).toLocaleString()}`\n              )\n              .join(\"\\n\\n\");\n\n        // Create callback content with formatted text\n        if (callback) {\n          await callback({\n            text: publisherCaps.length === 0\n              ? \"No publisher caps found\"\n              : `Retrieved ${publisherCaps.length} publisher caps:\\n\\n${formattedText}`,\n            success: true,\n            data: {\n              caps: publisherCaps.map((cap) => ({\n                publisher: cap.publisher,\n                cap: cap.cap,\n                timestamp: currentTimestamp,\n              })),\n              count: publisherCaps.length,\n            },\n          } as GetLatestPublisherCapsContent);\n        }\n\n        return true;\n      } catch (error) {\n        logGranular(\"Failed to process publisher caps request\", { error });\n        \n        // Call the callback with error information\n        if (callback) {\n          await callback({\n            text: `Error retrieving publisher caps: ${error instanceof Error ? error.message : String(error)}`,\n            success: false,\n            data: {\n              caps: [],\n              count: 0,\n              error: error instanceof Error ? error.message : String(error),\n            },\n          } as GetLatestPublisherCapsContent);\n        }\n        \n        if (error instanceof DataError) {\n          throw error;\n        }\n        throw new DataError(\n          DataErrorCode.VALIDATION_FAILED,\n          \"Failed to process publisher caps request\",\n          ErrorSeverity.HIGH,\n          { originalError: error }\n        );\n      }\n    } catch (error) {\n      logGranular(\"Failed to get publisher caps\", { error });\n      if (error instanceof DataError) {\n        throw error;\n      }\n      throw new DataError(\n        DataErrorCode.NETWORK_ERROR,\n        \"Failed to get publisher caps\",\n        ErrorSeverity.HIGH,\n        { originalError: error }\n      );\n    }\n  },\n};\n\nexport default getLatestPublisherCapsAction;\n","import { elizaLogger } from \"@elizaos/core\";\nimport { DataError, PythErrorCode, ErrorSeverity } from \"../error\";\nimport Ajv, { type ErrorObject } from \"ajv\";\n\nconst ajv = new Ajv({\n  allErrors: true,\n  verbose: true,\n  coerceTypes: false,\n  useDefaults: true,\n});\n\n// Publisher caps schema\nexport const publisherCapsSchema = {\n  type: \"object\",\n  required: [\"text\"],\n  properties: {\n    text: { type: \"string\" },\n    limit: { type: \"number\" },\n    offset: { type: \"number\" },\n  },\n};\n\n/**\n * Validates publisher caps data against the schema\n * @param data Data to validate\n * @returns Promise<boolean> True if validation succeeds\n * @throws DataError if validation fails\n */\nexport async function validatePublisherCapsData(data: unknown): Promise<void> {\n  try {\n    const validate = ajv.compile(publisherCapsSchema);\n    const valid = validate(data);\n\n    if (!valid) {\n      const errors = validate.errors || [];\n      elizaLogger.error(\"Publisher caps validation failed\", {\n        errors,\n        data,\n      });\n\n      throw new DataError(\n        PythErrorCode.DATA_VALIDATION_FAILED,\n        \"Publisher caps validation failed\",\n        ErrorSeverity.HIGH,\n        {\n          errors: errors.map((err: ErrorObject) => ({\n            path: err.schemaPath,\n            message: err.message,\n            params: err.params,\n          })),\n          data,\n        }\n      );\n    }\n\n    // Validation passed\n  } catch (error) {\n    if (error instanceof DataError) {\n      throw error;\n    }\n\n    elizaLogger.error(\"Publisher caps validation error\", {\n      error: error instanceof Error ? error.message : String(error),\n      data,\n    });\n\n    throw new DataError(\n      PythErrorCode.DATA_SCHEMA_ERROR,\n      \"Publisher caps validation error\",\n      ErrorSeverity.HIGH,\n      {\n        error: error instanceof Error ? error.message : String(error),\n        data,\n      }\n    );\n  }\n}\n\n/**\n * Validates a publisher address format\n * @param publisher Publisher address to validate\n * @returns boolean True if address is valid\n */\nexport function validatePublisherAddress(publisher: string): boolean {\n  return /^0x[a-fA-F0-9]{40}$/.test(publisher);\n}\n\n/**\n * Validates a cap value\n * @param cap Cap value to validate\n * @returns boolean True if cap is valid\n */\nexport function validateCap(cap: number): boolean {\n  return !isNaN(cap) && cap >= 0;\n}\n"],"mappings":"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","names":["elizaLogger","config","z","z","elizaLogger","config","elizaLogger","HermesClient","z","elizaLogger","z","config","GRANULAR_LOG","logGranular","elizaLogger","HermesClient","elizaLogger","HermesClient","elizaLogger","elizaLogger","config","GRANULAR_LOG","logGranular","elizaLogger","HermesClient","elizaLogger","HermesClient","elizaLogger","Ajv","ajv","elizaLogger","config","GRANULAR_LOG","logGranular","elizaLogger","HermesClient"]}