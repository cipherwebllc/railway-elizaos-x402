{"version":3,"sources":["../src/actions/getPrice/index.ts","../src/environment.ts","../src/actions/getPrice/examples.ts","../src/actions/getPrice/service.ts","../src/actions/getPrice/template.ts","../src/actions/getPrice/validation.ts","../src/index.ts"],"sourcesContent":["import {\n  composePromptFromState,\n  elizaLogger,\n  parseKeyValueXml,\n  type HandlerCallback,\n  type IAgentRuntime,\n  type Memory,\n  ModelType,\n  type State,\n  type Action,\n} from \"@elizaos/core\";\nimport { validateCoinMarketCapConfig } from \"../../environment\";\nimport { priceExamples } from \"./examples\";\nimport { createPriceService } from \"./service\";\nimport { getPriceTemplate } from \"./template\";\nimport type { GetPriceContent } from \"./types\";\nimport { isGetPriceContent } from \"./validation\";\n\nexport default {\n  name: \"GET_PRICE\",\n  similes: [\n    \"CHECK_PRICE\",\n    \"PRICE_CHECK\",\n    \"GET_CRYPTO_PRICE\",\n    \"CHECK_CRYPTO_PRICE\",\n    \"GET_TOKEN_PRICE\",\n    \"CHECK_TOKEN_PRICE\",\n  ],\n  // eslint-disable-next-line\n  validate: async (runtime: IAgentRuntime, _message: Memory) => {\n    await validateCoinMarketCapConfig(runtime);\n    return true;\n  },\n  description: \"Get the current price of a cryptocurrency from CoinMarketCap\",\n  handler: async (\n    runtime: IAgentRuntime,\n    message: Memory,\n    state: State,\n    _options: { [key: string]: unknown },\n    callback?: HandlerCallback\n  ): Promise<boolean> => {\n    elizaLogger.log(\"Starting CoinMarketCap GET_PRICE handler...\");\n\n    // Initialize or update state\n    let currentState = state;\n    if (!currentState) {\n      currentState = await runtime.composeState(message);\n    } else {\n      currentState = await runtime.composeState(message, [\"RECENT_MESSAGES\"]);\n    }\n\n    try {\n      // Compose prompt and generate price check content\n      const prompt = composePromptFromState({\n        state: currentState,\n        template: getPriceTemplate,\n      });\n\n      const response = await runtime.useModel(ModelType.SMALL, {\n        prompt,\n      });\n\n      const xmlContent = parseKeyValueXml(response);\n\n      const content: GetPriceContent = {\n        symbol: xmlContent?.symbol || \"BTC\",\n        currency: xmlContent?.currency || \"USD\",\n      };\n\n      // Validate content\n      if (!isGetPriceContent(content)) {\n        throw new Error(\"Invalid price check content\");\n      }\n\n      // Get price from CoinMarketCap\n      const config = await validateCoinMarketCapConfig(runtime);\n\n      const priceService = createPriceService(config.COINMARKETCAP_API_KEY);\n\n      try {\n        const priceData = await priceService.getPrice(\n          content.symbol,\n          content.currency\n        );\n        elizaLogger.success(\n          `Price retrieved successfully! ${content.symbol}: ${priceData.price} ${content.currency.toUpperCase()}`\n        );\n\n        if (callback) {\n          callback({\n            text: `The current price of ${content.symbol} is ${priceData.price} ${content.currency.toUpperCase()}`,\n            content: {\n              symbol: content.symbol,\n              currency: content.currency,\n              ...priceData,\n            },\n          });\n        }\n\n        return true;\n      } catch (error) {\n        const errorMessage =\n          error instanceof Error ? error.message : \"Unknown error\";\n        elizaLogger.error(\"Error in GET_PRICE handler:\", error);\n        if (callback) {\n          callback({\n            text: `Error fetching price: ${errorMessage}`,\n            content: { error: errorMessage },\n          });\n        }\n        return false;\n      }\n    } catch (error) {\n      const errorMessage =\n        error instanceof Error ? error.message : \"Unknown error\";\n      elizaLogger.error(\"Error in GET_PRICE handler:\", error);\n      if (callback) {\n        callback({\n          text: `Error fetching price: ${errorMessage}`,\n          content: { error: errorMessage },\n        });\n      }\n      return false;\n    }\n  },\n  examples: priceExamples,\n} as Action;\n","import type { IAgentRuntime } from \"@elizaos/core\";\nimport { z } from \"zod\";\n\nexport const coinmarketcapEnvSchema = z.object({\n  COINMARKETCAP_API_KEY: z.string().min(1, \"Required\").trim(),\n});\n\nexport type CoinMarketCapConfig = z.infer<typeof coinmarketcapEnvSchema>;\n\nexport async function validateCoinMarketCapConfig(\n  runtime: IAgentRuntime\n): Promise<CoinMarketCapConfig> {\n  try {\n    const config = {\n      COINMARKETCAP_API_KEY: runtime.getSetting(\"COINMARKETCAP_API_KEY\"),\n    };\n\n    return coinmarketcapEnvSchema.parse(config);\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      throw new Error(\"COINMARKETCAP_API_KEY is required\");\n    }\n    throw error;\n  }\n}\n","import type { ActionExample } from \"@elizaos/core\";\n\nexport const priceExamples: ActionExample[][] = [\n  [\n    {\n      name: \"{{user1}}\",\n      content: {\n        text: \"What's the current price of Bitcoin?\",\n      },\n    },\n    {\n      name: \"{{agent}}\",\n      content: {\n        text: \"Let me check the current Bitcoin price for you.\",\n        action: \"GET_PRICE\",\n      },\n    },\n    {\n      name: \"{{agent}}\",\n      content: {\n        text: \"The current price of BTC is 65,432.21 USD\",\n      },\n    },\n  ],\n  [\n    {\n      name: \"{{user1}}\",\n      content: {\n        text: \"Check ETH price in EUR\",\n      },\n    },\n    {\n      name: \"{{agent}}\",\n      content: {\n        text: \"I'll check the current Ethereum price in EUR.\",\n        action: \"GET_PRICE\",\n      },\n    },\n    {\n      name: \"{{agent}}\",\n      content: {\n        text: \"The current price of ETH is 2,345.67 EUR\",\n      },\n    },\n  ],\n];\n","import axios from \"axios\";\nimport type { ApiResponse, PriceData } from \"./types\";\n\nconst BASE_URL = \"https://pro-api.coinmarketcap.com/v1\";\n\nexport const createPriceService = (apiKey: string) => {\n  const client = axios.create({\n    baseURL: BASE_URL,\n    headers: {\n      \"X-CMC_PRO_API_KEY\": apiKey,\n      Accept: \"application/json\",\n    },\n  });\n\n  const getPrice = async (\n    symbol: string,\n    currency: string\n  ): Promise<PriceData> => {\n    const normalizedSymbol = symbol.toUpperCase().trim();\n    const normalizedCurrency = currency.toUpperCase().trim();\n\n    try {\n      const response = await client.get<ApiResponse>(\n        \"/cryptocurrency/quotes/latest\",\n        {\n          params: {\n            symbol: normalizedSymbol,\n            convert: normalizedCurrency,\n          },\n        }\n      );\n\n      console.log(\"API Response:\", JSON.stringify(response.data, null, 2));\n\n      const symbolData = response.data.data[normalizedSymbol];\n      if (!symbolData) {\n        throw new Error(`No data found for symbol: ${normalizedSymbol}`);\n      }\n\n      const quoteData = symbolData.quote[normalizedCurrency];\n      if (!quoteData) {\n        throw new Error(\n          `No quote data found for currency: ${normalizedCurrency}`\n        );\n      }\n\n      return {\n        price: quoteData.price,\n        marketCap: quoteData.market_cap,\n        volume24h: quoteData.volume_24h,\n        percentChange24h: quoteData.percent_change_24h,\n      };\n    } catch (error) {\n      if (axios.isAxiosError(error)) {\n        const errorMessage =\n          error.response?.data?.status?.error_message || error.message;\n        console.error(\"API Error:\", errorMessage);\n        throw new Error(`API Error: ${errorMessage}`);\n      }\n      throw error;\n    }\n  };\n\n  return { getPrice };\n};\n","export const getPriceTemplate = `Extract the cryptocurrency symbol and currency from the user's request.\n\nHere are the cryptocurrency symbol mappings:\n- bitcoin/btc -> BTC\n- ethereum/eth -> ETH\n- solana/sol -> SOL\n- cardano/ada -> ADA\n- ripple/xrp -> XRP\n- dogecoin/doge -> DOGE\n- polkadot/dot -> DOT\n- usdc -> USDC\n- tether/usdt -> USDT\n\n{{recentMessages}}\n\nExtract the cryptocurrency from the most recent message. Currency defaults to \"USD\" if not specified.\nRespond in XML format with both symbol and currency:\n\n<price_request>\n<symbol>BTC</symbol>\n<currency>USD</currency>\n</price_request>`;\n","import { z } from \"zod\";\nimport type { GetPriceContent } from \"./types\";\n\nexport const GetPriceSchema = z.object({\n  symbol: z.string(),\n  currency: z.string().default(\"USD\"),\n});\n\nexport function isGetPriceContent(\n  content: unknown\n): content is GetPriceContent {\n  if (!content || typeof content !== \"object\") {\n    return false;\n  }\n\n  const obj = content as any;\n\n  return (\n    typeof obj.symbol === \"string\" &&\n    obj.symbol.length > 0 &&\n    typeof obj.currency === \"string\" &&\n    obj.currency.length > 0\n  );\n}\n","import type { Plugin } from \"@elizaos/core\";\nimport getPrice from \"./actions/getPrice\";\n\nexport const coinmarketcapPlugin: Plugin = {\n  name: \"coinmarketcap\",\n  description: \"CoinMarketCap Plugin for Eliza\",\n  actions: [getPrice],\n  evaluators: [],\n  providers: [],\n};\n\nexport default coinmarketcapPlugin;\n"],"mappings":"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","names":["z"]}